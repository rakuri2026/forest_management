// This file contains the remaining 3 sections for AnalysisTabContent
// To be merged into AnalysisTabContent.tsx

/*
  Add these sections after the Terrain & Climate section in AnalysisTabContent.tsx
*/

// Section 3: Land Cover & Change
<CollapsibleSection
  title="Land Cover & Change Detection"
  icon="ðŸ“Š"
  defaultExpanded={false}
  headerColor="yellow"
>
  <div className="p-6 space-y-6">
    {/* Land Cover Timeline */}
    {(data.landcover_1984_dominant || data.hansen2000_dominant || data.landcover_dominant) && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Land Cover Evolution</h4>
        <div className="bg-gray-50 p-4 rounded-lg">
          <div className="flex items-center justify-between mb-4">
            <div className="flex-1 text-center">
              <div className="text-xs font-medium text-gray-500 mb-1">1984</div>
              <div className="text-sm font-semibold text-gray-900 capitalize">
                {data.landcover_1984_dominant || 'N/A'}
              </div>
            </div>
            <div className="px-4">
              <svg className="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </div>
            <div className="flex-1 text-center">
              <div className="text-xs font-medium text-gray-500 mb-1">2000</div>
              <div className="text-sm font-semibold text-gray-900 capitalize">
                {data.hansen2000_dominant || 'N/A'}
              </div>
            </div>
            <div className="px-4">
              <svg className="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </div>
            <div className="flex-1 text-center">
              <div className="text-xs font-medium text-gray-500 mb-1">Current</div>
              <div className="text-sm font-semibold text-green-700 capitalize">
                {data.landcover_dominant || 'N/A'}
              </div>
            </div>
          </div>
        </div>
      </div>
    )}

    {/* Forest Loss */}
    {data.forest_loss_hectares !== undefined && data.forest_loss_hectares !== null && data.forest_loss_hectares >= 0 && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Forest Loss (2001-2023)</h4>
        <div className="bg-red-50 border border-red-200 p-4 rounded-lg">
          <div className="flex justify-between items-center mb-3">
            <span className="text-sm font-medium text-gray-700">Total Loss:</span>
            <span className="text-2xl font-bold text-red-700">
              <EditableCell
                value={data.forest_loss_hectares}
                displayValue={`${data.forest_loss_hectares.toFixed(2)} ha`}
                onSave={(v) => handleSaveWholeForest('forest_loss_hectares', v)}
              />
            </span>
          </div>
          {data.forest_loss_by_year && Object.keys(data.forest_loss_by_year).length > 0 && (
            <div className="mt-3">
              <p className="text-xs font-medium text-gray-600 mb-2">Loss by Year:</p>
              <div className="max-h-40 overflow-y-auto space-y-1">
                {Object.entries(data.forest_loss_by_year)
                  .sort(([yearA], [yearB]) => parseInt(yearB) - parseInt(yearA))
                  .map(([year, ha]: [string, any]) => (
                    ha > 0 && (
                      <div key={year} className="flex justify-between text-xs">
                        <span className="text-gray-700">{year}:</span>
                        <span className="font-medium text-red-700">
                          <EditableCell
                            value={ha}
                            displayValue={`${ha.toFixed(2)} ha`}
                            onSave={(v) => handleSaveWholePercentages('forest_loss_by_year', year, v)}
                          />
                        </span>
                      </div>
                    )
                  ))}
              </div>
            </div>
          )}
        </div>
      </div>
    )}

    {/* Forest Gain */}
    {data.forest_gain_hectares !== undefined && data.forest_gain_hectares !== null && data.forest_gain_hectares >= 0 && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Forest Gain (2000-2012)</h4>
        <div className="bg-green-50 border border-green-200 p-4 rounded-lg">
          <div className="flex justify-between items-center">
            <span className="text-sm font-medium text-gray-700">Total Gain:</span>
            <span className="text-2xl font-bold text-green-700">
              <EditableCell
                value={data.forest_gain_hectares}
                displayValue={`${data.forest_gain_hectares.toFixed(2)} ha`}
                onSave={(v) => handleSaveWholeForest('forest_gain_hectares', v)}
              />
            </span>
          </div>
          <p className="text-xs text-gray-600 mt-2">Net forest gain over 12-year period</p>
        </div>
      </div>
    )}

    {/* Fire Loss */}
    {data.fire_loss_hectares !== undefined && data.fire_loss_hectares !== null && data.fire_loss_hectares >= 0 && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Fire-Related Loss (2001-2023)</h4>
        <div className="bg-orange-50 border border-orange-200 p-4 rounded-lg">
          <div className="flex justify-between items-center mb-3">
            <span className="text-sm font-medium text-gray-700">Total Fire Loss:</span>
            <span className="text-2xl font-bold text-orange-700">
              <EditableCell
                value={data.fire_loss_hectares}
                displayValue={`${data.fire_loss_hectares.toFixed(2)} ha`}
                onSave={(v) => handleSaveWholeForest('fire_loss_hectares', v)}
              />
            </span>
          </div>
          {data.fire_loss_by_year && Object.keys(data.fire_loss_by_year).length > 0 && (
            <div className="mt-3">
              <p className="text-xs font-medium text-gray-600 mb-2">Fire Events:</p>
              <div className="space-y-1">
                {Object.entries(data.fire_loss_by_year)
                  .sort(([yearA], [yearB]) => parseInt(yearB) - parseInt(yearA))
                  .map(([year, ha]: [string, any]) => (
                    ha > 0 && (
                      <div key={year} className="flex justify-between text-xs">
                        <span className="text-gray-700">{year}:</span>
                        <span className="font-medium text-orange-700">
                          <EditableCell
                            value={ha}
                            displayValue={`${ha.toFixed(2)} ha`}
                            onSave={(v) => handleSaveWholePercentages('fire_loss_by_year', year, v)}
                          />
                        </span>
                      </div>
                    )
                  ))}
              </div>
            </div>
          )}
        </div>
      </div>
    )}
  </div>
</CollapsibleSection>

// Section 4: Soil Analysis
<CollapsibleSection
  title="Soil Analysis"
  icon="ðŸŒ"
  defaultExpanded={false}
  headerColor="gray"
>
  <div className="p-6 space-y-6">
    {/* Soil Texture */}
    {data.soil_texture && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Soil Texture & Composition</h4>
        <div className="bg-gray-50 p-4 rounded-lg space-y-2">
          <div className="flex justify-between">
            <span className="text-sm text-gray-700">Texture Class:</span>
            <span className="text-sm font-semibold text-gray-900">
              <EditableCell value={data.soil_texture} onSave={(v) => handleSaveWholeForest('soil_texture', v)} />
              {data.soil_texture_system && (
                <span className="text-xs text-gray-500 ml-2">({data.soil_texture_system})</span>
              )}
            </span>
          </div>
          {data.soil_properties && (
            <div className="pt-2 border-t border-gray-300 text-xs text-gray-600">
              {Object.entries(data.soil_properties)
                .map(([prop, val]: [string, any]) => `${prop}: ${val}`)
                .join(', ')}
            </div>
          )}
        </div>
      </div>
    )}

    {/* Fertility */}
    {data.fertility_class && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Soil Fertility Assessment</h4>
        <div className="bg-gray-50 p-4 rounded-lg">
          <div className="flex justify-between items-center mb-3">
            <span className="text-sm font-medium text-gray-700">Fertility Class:</span>
            <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
              data.fertility_class === 'Very High' ? 'bg-green-100 text-green-800' :
              data.fertility_class === 'High' ? 'bg-green-50 text-green-700' :
              data.fertility_class === 'Medium' ? 'bg-yellow-100 text-yellow-800' :
              data.fertility_class === 'Low' ? 'bg-orange-100 text-orange-800' :
              'bg-red-100 text-red-800'
            }`}>
              {data.fertility_class}
            </span>
          </div>
          {data.fertility_score && (
            <div className="text-center mb-3">
              <span className="text-3xl font-bold text-gray-900">{data.fertility_score}</span>
              <span className="text-sm text-gray-500">/100</span>
            </div>
          )}
          {data.limiting_factors && data.limiting_factors.length > 0 && (
            <div className="pt-3 border-t border-gray-300">
              <p className="text-xs font-medium text-gray-600 mb-2">Limiting Factors:</p>
              <ul className="text-xs text-gray-700 space-y-1">
                {data.limiting_factors.map((factor: string, idx: number) => (
                  <li key={idx}>â€¢ {factor}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </div>
    )}

    {/* Carbon Stock */}
    {data.carbon_stock_t_ha && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Soil Carbon Content</h4>
        <div className="bg-gray-50 p-4 rounded-lg">
          <div className="flex justify-between items-center">
            <span className="text-sm font-medium text-gray-700">Organic Carbon Stock:</span>
            <span className="text-lg font-bold text-green-700">
              <EditableCell
                value={data.carbon_stock_t_ha}
                displayValue={`${data.carbon_stock_t_ha} t/ha`}
                onSave={(v) => handleSaveWholeForest('carbon_stock_t_ha', v)}
              />
            </span>
          </div>
          <p className="text-xs text-gray-600 mt-2">Topsoil (0-30cm) organic carbon stock</p>
        </div>
      </div>
    )}

    {/* Compaction Status */}
    {data.compaction_status && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Compaction Status</h4>
        <div className="bg-gray-50 p-4 rounded-lg">
          <div className="flex justify-between items-center mb-2">
            <span className="text-sm font-medium text-gray-700">Status:</span>
            <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
              data.compaction_status === 'Not compacted' ? 'bg-green-100 text-green-800' :
              data.compaction_status === 'Slight compaction' ? 'bg-yellow-100 text-yellow-800' :
              data.compaction_status === 'Moderate compaction' ? 'bg-orange-100 text-orange-800' :
              'bg-red-100 text-red-800'
            }`}>
              {data.compaction_status}
            </span>
          </div>
          {data.compaction_alert && (
            <p className="text-xs text-gray-600 mt-2">{data.compaction_alert}</p>
          )}
        </div>
      </div>
    )}
  </div>
</CollapsibleSection>

// Section 5: Location & Context
<CollapsibleSection
  title="Location & Administrative Context"
  icon="ðŸ“"
  defaultExpanded={false}
  headerColor="gray"
>
  <div className="p-6 space-y-6">
    {/* Administrative Boundaries */}
    <div>
      <h4 className="text-md font-semibold text-gray-900 mb-3">Administrative Boundaries</h4>
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1">Province</div>
          <div className="text-sm font-semibold text-gray-900">
            <EditableCell value={data.whole_province} onSave={(v) => handleSaveWholeForest('whole_province', v)} />
          </div>
        </div>
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1">District</div>
          <div className="text-sm font-semibold text-gray-900">
            <EditableCell value={data.whole_district} onSave={(v) => handleSaveWholeForest('whole_district', v)} />
          </div>
        </div>
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1">Municipality</div>
          <div className="text-sm font-semibold text-gray-900">
            <EditableCell value={data.whole_municipality} onSave={(v) => handleSaveWholeForest('whole_municipality', v)} />
          </div>
        </div>
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1">Ward</div>
          <div className="text-sm font-semibold text-gray-900">
            <EditableCell value={data.whole_ward} onSave={(v) => handleSaveWholeForest('whole_ward', v)} />
          </div>
        </div>
      </div>
    </div>

    {/* Watershed & Hydrology */}
    <div>
      <h4 className="text-md font-semibold text-gray-900 mb-3">Watershed & Hydrology</h4>
      <div className="bg-gray-50 p-4 rounded-lg space-y-2">
        <div className="flex justify-between">
          <span className="text-sm text-gray-700">Watershed:</span>
          <span className="text-sm font-semibold text-gray-900">
            <EditableCell value={data.whole_watershed} onSave={(v) => handleSaveWholeForest('whole_watershed', v)} />
          </span>
        </div>
        <div className="flex justify-between">
          <span className="text-sm text-gray-700">Major River Basin:</span>
          <span className="text-sm font-semibold text-gray-900">
            <EditableCell value={data.whole_major_river_basin} onSave={(v) => handleSaveWholeForest('whole_major_river_basin', v)} />
          </span>
        </div>
      </div>
    </div>

    {/* Geographic Classifications */}
    {(data.whole_geology_percentages || data.whole_physiography_percentages || data.whole_ecoregion_percentages) && (
      <div>
        <h4 className="text-md font-semibold text-gray-900 mb-3">Geographic Classifications</h4>
        <div className="bg-gray-50 p-4 rounded-lg space-y-3">
          {data.whole_geology_percentages && Object.keys(data.whole_geology_percentages).length > 0 && (
            <div>
              <p className="text-xs font-medium text-gray-600 mb-1">Geology:</p>
              <div className="text-xs text-gray-700">
                {Object.entries(data.whole_geology_percentages).map(([cls, pct]: [string, any], idx: number, arr: any[]) => (
                  <span key={cls}>
                    {cls}: <EditableCell value={pct} displayValue={`${pct.toFixed(1)}%`} onSave={(v) => handleSaveWholePercentages('whole_geology_percentages', cls, v)} className="inline" />
                    {idx < arr.length - 1 && ', '}
                  </span>
                ))}
              </div>
            </div>
          )}
          {data.whole_physiography_percentages && Object.keys(data.whole_physiography_percentages).length > 0 && (
            <div>
              <p className="text-xs font-medium text-gray-600 mb-1">Physiography:</p>
              <div className="text-xs text-gray-700">
                {Object.entries(data.whole_physiography_percentages).map(([zone, pct]: [string, any], idx: number, arr: any[]) => (
                  <span key={zone}>
                    {zone}: <EditableCell value={pct} displayValue={`${pct.toFixed(2)}%`} onSave={(v) => handleSaveWholePercentages('whole_physiography_percentages', zone, v)} className="inline" />
                    {idx < arr.length - 1 && ', '}
                  </span>
                ))}
              </div>
            </div>
          )}
          {data.whole_ecoregion_percentages && Object.keys(data.whole_ecoregion_percentages).length > 0 && (
            <div>
              <p className="text-xs font-medium text-gray-600 mb-1">Ecoregion:</p>
              <div className="text-xs text-gray-700">
                {Object.entries(data.whole_ecoregion_percentages).map(([eco, pct]: [string, any], idx: number, arr: any[]) => (
                  <span key={eco}>
                    {eco}: <EditableCell value={pct} displayValue={`${pct.toFixed(2)}%`} onSave={(v) => handleSaveWholePercentages('whole_ecoregion_percentages', eco, v)} className="inline" />
                    {idx < arr.length - 1 && ', '}
                  </span>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    )}

    {/* Directional Features */}
    <div>
      <h4 className="text-md font-semibold text-gray-900 mb-3">Natural Features (within 100m)</h4>
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1 font-medium">North</div>
          <div className="text-xs text-gray-700">
            <EditableCell value={data.whole_features_north || ''} onSave={(v) => handleSaveWholeForest('whole_features_north', v)} />
          </div>
        </div>
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1 font-medium">East</div>
          <div className="text-xs text-gray-700">
            <EditableCell value={data.whole_features_east || ''} onSave={(v) => handleSaveWholeForest('whole_features_east', v)} />
          </div>
        </div>
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1 font-medium">South</div>
          <div className="text-xs text-gray-700">
            <EditableCell value={data.whole_features_south || ''} onSave={(v) => handleSaveWholeForest('whole_features_south', v)} />
          </div>
        </div>
        <div className="bg-gray-50 p-3 rounded-lg">
          <div className="text-xs text-gray-600 mb-1 font-medium">West</div>
          <div className="text-xs text-gray-700">
            <EditableCell value={data.whole_features_west || ''} onSave={(v) => handleSaveWholeForest('whole_features_west', v)} />
          </div>
        </div>
      </div>
    </div>
  </div>
</CollapsibleSection>
