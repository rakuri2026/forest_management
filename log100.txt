Starting Backend Server...
DEBUG: Species router loaded with prefix:
DEBUG: Species router has 6 routes
DEBUG: Including species router...
DEBUG: Species router included. Total app routes: 37
INFO:     Started server process [4824]
INFO:     Waiting for application startup.
Starting Community Forest Management System v1.0.0
Debug mode: True
2026-02-07 14:29:40,543 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-07 14:29:40,544 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-02-07 14:29:40,546 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-07 14:29:40,546 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-02-07 14:29:40,547 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-07 14:29:40,548 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-02-07 14:29:40,553 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:40,553 INFO sqlalchemy.engine.Engine SELECT 1
2026-02-07 14:29:40,553 INFO sqlalchemy.engine.Engine [generated in 0.00049s] {}
2026-02-07 14:29:40,553 INFO sqlalchemy.engine.Engine ROLLBACK
Database connection successful
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     127.0.0.1:61665 - "OPTIONS /api/auth/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:62605 - "OPTIONS /api/auth/me HTTP/1.1" 200 OK
2026-02-07 14:29:40,664 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:40,668 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:40,668 INFO sqlalchemy.engine.Engine [generated in 0.00039s] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:40,732 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:40,733 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:40,733 INFO sqlalchemy.engine.Engine [cached since 0.06565s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
INFO:     127.0.0.1:62605 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:61665 - "GET /api/auth/me HTTP/1.1" 200 OK
2026-02-07 14:29:40,740 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:29:40,740 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:61665 - "OPTIONS /api/forests/calculations HTTP/1.1" 200 OK
INFO:     127.0.0.1:62605 - "OPTIONS /api/forests/calculations HTTP/1.1" 200 OK
2026-02-07 14:29:40,751 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:40,751 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:40,752 INFO sqlalchemy.engine.Engine [cached since 0.08431s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:40,756 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.user_id = %(user_id_1)s::UUID ORDER BY public.calculations.created_at DESC
 LIMIT %(param_1)s OFFSET %(param_2)s
2026-02-07 14:29:40,757 INFO sqlalchemy.engine.Engine [generated in 0.00051s] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a'), 'param_1': 50, 'param_2': 0}
2026-02-07 14:29:40,790 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:40,791 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:40,791 INFO sqlalchemy.engine.Engine [cached since 0.1235s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:40,792 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.user_id = %(user_id_1)s::UUID ORDER BY public.calculations.created_at DESC
 LIMIT %(param_1)s OFFSET %(param_2)s
2026-02-07 14:29:40,793 INFO sqlalchemy.engine.Engine [cached since 0.03658s ago] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a'), 'param_1': 50, 'param_2': 0}
INFO:     127.0.0.1:61665 - "GET /api/forests/calculations HTTP/1.1" 200 OK
INFO:     127.0.0.1:62605 - "GET /api/forests/calculations HTTP/1.1" 200 OK
2026-02-07 14:29:40,803 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:29:40,803 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:65504 - "OPTIONS /api/auth/login HTTP/1.1" 200 OK
2026-02-07 14:29:51,655 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:51,658 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.email = %(email_1)s
 LIMIT %(param_1)s
2026-02-07 14:29:51,658 INFO sqlalchemy.engine.Engine [generated in 0.00081s] {'email_1': 'demo@forest.com', 'param_1': 1}
2026-02-07 14:29:52,173 INFO sqlalchemy.engine.Engine UPDATE public.users SET last_login=%(last_login)s WHERE public.users.id = %(public_users_id)s::UUID
2026-02-07 14:29:52,173 INFO sqlalchemy.engine.Engine [generated in 0.00045s] {'last_login': datetime.datetime(2026, 2, 7, 8, 44, 52, 171713), 'public_users_id': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a')}
2026-02-07 14:29:52,177 INFO sqlalchemy.engine.Engine COMMIT
2026-02-07 14:29:52,193 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:52,195 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(pk_1)s::UUID
2026-02-07 14:29:52,195 INFO sqlalchemy.engine.Engine [generated in 0.00044s] {'pk_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a')}
INFO:     127.0.0.1:65504 - "POST /api/auth/login HTTP/1.1" 200 OK
2026-02-07 14:29:52,199 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:29:52,205 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:52,205 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:52,206 INFO sqlalchemy.engine.Engine [cached since 11.54s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
INFO:     127.0.0.1:65504 - "GET /api/auth/me HTTP/1.1" 200 OK
2026-02-07 14:29:52,209 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:65504 - "OPTIONS /api/forests/my-forests HTTP/1.1" 200 OK
INFO:     127.0.0.1:59949 - "OPTIONS /api/forests/my-forests HTTP/1.1" 200 OK
2026-02-07 14:29:52,268 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:52,269 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:52,269 INFO sqlalchemy.engine.Engine [cached since 11.6s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:52,275 INFO sqlalchemy.engine.Engine SELECT admin."community forests".id AS "admin_community forests_id", ST_AsEWKB(admin."community forests".geom) AS "admin_community forests_geom", admin."community forests".name AS "admin_community forests_name", admin."community forests".code AS "admin_community forests_code", admin."community forests".regime AS "admin_community forests_regime", admin."community forests"."area sqm" AS "admin_community forests_area sqm", public.forest_managers.role AS public_forest_managers_role
FROM admin."community forests" JOIN public.forest_managers ON public.forest_managers.community_forest_id = admin."community forests".id
WHERE public.forest_managers.user_id = %(user_id_1)s::UUID AND public.forest_managers.is_active = true
2026-02-07 14:29:52,275 INFO sqlalchemy.engine.Engine [generated in 0.00051s] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a')}
2026-02-07 14:29:52,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:52,290 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:52,290 INFO sqlalchemy.engine.Engine [cached since 11.62s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:52,293 INFO sqlalchemy.engine.Engine SELECT admin."community forests".id AS "admin_community forests_id", ST_AsEWKB(admin."community forests".geom) AS "admin_community forests_geom", admin."community forests".name AS "admin_community forests_name", admin."community forests".code AS "admin_community forests_code", admin."community forests".regime AS "admin_community forests_regime", admin."community forests"."area sqm" AS "admin_community forests_area sqm", public.forest_managers.role AS public_forest_managers_role
FROM admin."community forests" JOIN public.forest_managers ON public.forest_managers.community_forest_id = admin."community forests".id
WHERE public.forest_managers.user_id = %(user_id_1)s::UUID AND public.forest_managers.is_active = true
2026-02-07 14:29:52,293 INFO sqlalchemy.engine.Engine [cached since 0.01835s ago] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a')}
INFO:     127.0.0.1:65504 - "GET /api/forests/my-forests HTTP/1.1" 200 OK
INFO:     127.0.0.1:59949 - "GET /api/forests/my-forests HTTP/1.1" 200 OK
2026-02-07 14:29:52,303 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:29:52,303 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:29:55,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:55,293 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:55,293 INFO sqlalchemy.engine.Engine [cached since 14.63s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:55,298 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.user_id = %(user_id_1)s::UUID ORDER BY public.calculations.created_at DESC
 LIMIT %(param_1)s OFFSET %(param_2)s
2026-02-07 14:29:55,299 INFO sqlalchemy.engine.Engine [cached since 14.54s ago] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a'), 'param_1': 50, 'param_2': 0}
2026-02-07 14:29:55,303 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:29:55,303 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:29:55,304 INFO sqlalchemy.engine.Engine [cached since 14.64s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:29:55,306 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.user_id = %(user_id_1)s::UUID ORDER BY public.calculations.created_at DESC
 LIMIT %(param_1)s OFFSET %(param_2)s
2026-02-07 14:29:55,306 INFO sqlalchemy.engine.Engine [cached since 14.55s ago] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a'), 'param_1': 50, 'param_2': 0}
INFO:     127.0.0.1:65504 - "GET /api/forests/calculations HTTP/1.1" 200 OK
INFO:     127.0.0.1:59949 - "GET /api/forests/calculations HTTP/1.1" 200 OK
2026-02-07 14:29:55,312 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:29:55,312 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59949 - "OPTIONS /api/forests/calculations/cc28f722-8959-462f-aea3-64d9203ec94d HTTP/1.1" 200 OK
2026-02-07 14:30:00,043 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:30:00,043 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:30:00,044 INFO sqlalchemy.engine.Engine [cached since 19.38s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:30:00,049 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:30:00,050 INFO sqlalchemy.engine.Engine [generated in 0.00081s] {'id_1': UUID('cc28f722-8959-462f-aea3-64d9203ec94d'), 'param_1': 1}
2026-02-07 14:30:00,059 INFO sqlalchemy.engine.Engine SELECT public.fieldbook.id AS public_fieldbook_id, public.fieldbook.calculation_id AS public_fieldbook_calculation_id, public.fieldbook.point_number AS public_fieldbook_point_number, public.fieldbook.point_type AS public_fieldbook_point_type, public.fieldbook.block_number AS public_fieldbook_block_number, public.fieldbook.block_name AS public_fieldbook_block_name, public.fieldbook.longitude AS public_fieldbook_longitude, public.fieldbook.latitude AS public_fieldbook_latitude, public.fieldbook.easting_utm AS public_fieldbook_easting_utm, public.fieldbook.northing_utm AS public_fieldbook_northing_utm, public.fieldbook.utm_zone AS public_fieldbook_utm_zone, public.fieldbook.azimuth_to_next AS public_fieldbook_azimuth_to_next, public.fieldbook.distance_to_next AS public_fieldbook_distance_to_next, public.fieldbook.elevation AS public_fieldbook_elevation, public.fieldbook.remarks AS public_fieldbook_remarks, public.fieldbook.is_verified AS public_fieldbook_is_verified, ST_AsEWKB(public.fieldbook.point_geometry) AS public_fieldbook_point_geometry, public.fieldbook.created_at AS public_fieldbook_created_at, public.fieldbook.updated_at AS public_fieldbook_updated_at
FROM public.fieldbook
WHERE %(param_1)s::UUID = public.fieldbook.calculation_id
2026-02-07 14:30:00,060 INFO sqlalchemy.engine.Engine [generated in 0.00062s] {'param_1': UUID('cc28f722-8959-462f-aea3-64d9203ec94d')}
2026-02-07 14:30:00,087 INFO sqlalchemy.engine.Engine SELECT public.sampling_designs.id AS public_sampling_designs_id, public.sampling_designs.calculation_id AS public_sampling_designs_calculation_id, public.sampling_designs.sampling_type AS public_sampling_designs_sampling_type, public.sampling_designs.intensity_per_hectare AS public_sampling_designs_intensity_per_hectare, public.sampling_designs.grid_spacing_meters AS public_sampling_designs_grid_spacing_meters, public.sampling_designs.min_distance_meters AS public_sampling_designs_min_distance_meters, public.sampling_designs.plot_shape AS public_sampling_designs_plot_shape, public.sampling_designs.plot_radius_meters AS public_sampling_designs_plot_radius_meters, public.sampling_designs.plot_length_meters AS public_sampling_designs_plot_length_meters, public.sampling_designs.plot_width_meters AS public_sampling_designs_plot_width_meters, ST_AsEWKB(public.sampling_designs.exclusion_geometry) AS public_sampling_designs_exclusion_geometry, ST_AsEWKB(public.sampling_designs.points_geometry) AS public_sampling_designs_points_geometry, public.sampling_designs.total_points AS public_sampling_designs_total_points, public.sampling_designs.notes AS public_sampling_designs_notes, public.sampling_designs.points_block_assignment AS public_sampling_designs_points_block_assignment, public.sampling_designs.created_at AS public_sampling_designs_created_at, public.sampling_designs.updated_at AS public_sampling_designs_updated_at
FROM public.sampling_designs
WHERE %(param_1)s::UUID = public.sampling_designs.calculation_id
2026-02-07 14:30:00,088 INFO sqlalchemy.engine.Engine [generated in 0.00061s] {'param_1': UUID('cc28f722-8959-462f-aea3-64d9203ec94d')}
2026-02-07 14:30:00,098 INFO sqlalchemy.engine.Engine DELETE FROM public.fieldbook WHERE public.fieldbook.id = %(id)s::UUID
2026-02-07 14:30:00,098 INFO sqlalchemy.engine.Engine [generated in 0.00096s] [{'id': UUID('00372613-ee9c-44ff-876e-9779c91bc7ca')}, {'id': UUID('015e3796-f856-4a48-9d37-c2a767debdc6')}, {'id': UUID('03d89045-1d27-43db-b84c-45ec745e560a')}, {'id': UUID('03da3865-7177-46f7-bde1-fcf36a489b31')}, {'id': UUID('0421fe4a-b69b-4c3c-9670-e818fa0e5d34')}, {'id': UUID('0481b21c-9199-4aec-a8c2-0867ed56e7b7')}, {'id': UUID('04d4c673-6f97-463a-b7ef-7c6516d370c8')}, {'id': UUID('05d87058-eaeb-4e2b-8ff0-55a93da0518d')}  ... displaying 10 of 295 total bound parameter sets ...  {'id': UUID('fe947d39-2664-4f33-8cd7-e4db4caced3c')}, {'id': UUID('feeb0b58-d2ae-48ea-a459-32c883c1b475')}]
2026-02-07 14:30:00,188 INFO sqlalchemy.engine.Engine DELETE FROM public.calculations WHERE public.calculations.id = %(id)s::UUID
2026-02-07 14:30:00,189 INFO sqlalchemy.engine.Engine [generated in 0.00058s] {'id': UUID('cc28f722-8959-462f-aea3-64d9203ec94d')}
2026-02-07 14:30:00,213 INFO sqlalchemy.engine.Engine COMMIT
Successfully deleted calculation cc28f722-8959-462f-aea3-64d9203ec94d
INFO:     127.0.0.1:59949 - "DELETE /api/forests/calculations/cc28f722-8959-462f-aea3-64d9203ec94d HTTP/1.1" 204 No Content
2026-02-07 14:30:00,223 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:30:00,223 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:30:00,224 INFO sqlalchemy.engine.Engine [cached since 19.56s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:30:00,227 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.user_id = %(user_id_1)s::UUID ORDER BY public.calculations.created_at DESC
 LIMIT %(param_1)s OFFSET %(param_2)s
2026-02-07 14:30:00,228 INFO sqlalchemy.engine.Engine [cached since 19.47s ago] {'user_id_1': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a'), 'param_1': 50, 'param_2': 0}
INFO:     127.0.0.1:59949 - "GET /api/forests/calculations HTTP/1.1" 200 OK
2026-02-07 14:30:00,231 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59344 - "OPTIONS /api/forests/upload HTTP/1.1" 200 OK
2026-02-07 14:32:24,446 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:32:24,447 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:32:24,447 INFO sqlalchemy.engine.Engine [cached since 163.8s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:32:24,616 INFO sqlalchemy.engine.Engine INSERT INTO public.calculations (id, user_id, application_id, uploaded_filename, boundary_geom, forest_name, block_name, result_data, status, processing_time_seconds, error_message, created_at, completed_at) VALUES (%(id)s::UUID, %(user_id)s::UUID, %(application_id)s::UUID, %(uploaded_filename)s, ST_GeomFromText(%(ST_GeomFromText_1)s, %(ST_GeomFromText_2)s), %(forest_name)s, %(block_name)s, %(result_data)s::JSONB, %(status)s, %(processing_time_seconds)s, %(error_message)s, %(created_at)s, %(completed_at)s)
2026-02-07 14:32:24,617 INFO sqlalchemy.engine.Engine [generated in 0.00173s] {'id': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'user_id': UUID('68646d11-ba45-4a39-8ab5-951c90786f2a'), 'application_id': None, 'uploaded_filename': 'RameOnly.kml', 'ST_GeomFromText_1': 'MULTIPOLYGON (((85.0400647996589 27.452510086609063, 85.04009173000007 27.45254918800002, 85.04104511200006 27.45420717300007, 85.04199853799997 27.4 ... (4169 characters truncated) ... , 85.0371176834342 27.444607493047496, 85.0383621968111 27.44375104205515, 85.03995697256148 27.4427573593862, 85.0404909366054 27.442378263315423)))', 'ST_GeomFromText_2': 4326, 'forest_name': 'Bhame CF', 'block_name': 'Eklal', 'result_data': '{"total_blocks": 5, "blocks": [{"block_index": 0, "block_name": "Eklal", "area_sqm": 416608.63738251413, "area_hectares": 41.660863738251415, "geomet ... (5800 characters truncated) ... 9528010365, "lat": 27.44127061748549}}], "processing_info": {"partitioned": true, "partition_info": {"division_lines_used": 4, "blocks_created": 5}}}', 'status': 'PROCESSING', 'processing_time_seconds': None, 'error_message': None, 'created_at': datetime.datetime(2026, 2, 7, 8, 47, 24, 615413), 'completed_at': None}
2026-02-07 14:32:24,700 INFO sqlalchemy.engine.Engine COMMIT
2026-02-07 14:32:24,702 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:32:24,703 INFO sqlalchemy.engine.Engine SELECT public.calculations.id, public.calculations.user_id, public.calculations.application_id, public.calculations.uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS boundary_geom, public.calculations.forest_name, public.calculations.block_name, public.calculations.result_data, public.calculations.status, public.calculations.processing_time_seconds, public.calculations.error_message, public.calculations.created_at, public.calculations.completed_at
FROM public.calculations
WHERE public.calculations.id = %(pk_1)s::UUID
2026-02-07 14:32:24,704 INFO sqlalchemy.engine.Engine [generated in 0.00040s] {'pk_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f')}
Starting analysis for calculation 38bf84f9-d0e9-4f37-b08a-8d86ada4b89f
2026-02-07 14:32:24,707 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:32:24,707 INFO sqlalchemy.engine.Engine [cached since 144.7s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
Analyzing block 1/5: Eklal
2026-02-07 14:32:24,710 INFO sqlalchemy.engine.Engine
            SELECT ST_AsText(ST_GeomFromGeoJSON(%(geojson)s)) as wkt

2026-02-07 14:32:24,711 INFO sqlalchemy.engine.Engine [generated in 0.00051s] {'geojson': '{"type": "Polygon", "coordinates": [[[85.0400647996589, 27.452510086609063], [85.04009173000007, 27.45254918800002], [85.04104511200006, 27.454207173 ... (888 characters truncated) ... 464541, 27.45104893711257], [85.04167562347398, 27.45166959637476], [85.04075765321187, 27.45207690464419], [85.0400647996589, 27.452510086609063]]]}'}
2026-02-07 14:32:24,719 INFO sqlalchemy.engine.Engine
        SELECT
            ST_YMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as north,
            ST_YMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as south,
            ST_XMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as east,
            ST_XMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as west

2026-02-07 14:32:24,719 INFO sqlalchemy.engine.Engine [generated in 0.00061s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:24,730 INFO sqlalchemy.engine.Engine
            WITH clipped_raster AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.dem
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ),
            pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as elevation
                FROM clipped_raster
            )
            SELECT
                MIN(elevation) as elevation_min,
                MAX(elevation) as elevation_max,
                AVG(elevation) as elevation_mean
            FROM pixel_values
            WHERE elevation > -32000  -- Exclude NoData values (-32768)
              AND elevation >= 0       -- Nepal minimum elevation
              AND elevation <= 9000    -- Nepal maximum elevation

2026-02-07 14:32:24,731 INFO sqlalchemy.engine.Engine [generated in 0.00077s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:24,945 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as slope_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.slope
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value > 0
              AND (pvc).value <= 4
            GROUP BY slope_code

2026-02-07 14:32:24,945 INFO sqlalchemy.engine.Engine [generated in 0.00029s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:24,962 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as aspect_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.aspect
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 0 AND 8
            GROUP BY aspect_code

2026-02-07 14:32:24,962 INFO sqlalchemy.engine.Engine [generated in 0.00034s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:24,981 INFO sqlalchemy.engine.Engine
            WITH boundary AS (
                SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
            ),
            all_pixels AS (
                SELECT
                    (pix).val as height,
                    (pix).geom as pixel_center
                FROM (
                    SELECT ST_PixelAsPolygons(rast) as pix
                    FROM rasters.canopy_height, boundary
                    WHERE ST_Intersects(rast, geom)
                ) as subq
            )
            SELECT
                CASE
                    WHEN height = 0 THEN 'non_forest'
                    WHEN height > 0 AND height <= 5 THEN 'bush_regenerated'
                    WHEN height > 5 AND height <= 15 THEN 'pole_trees'
                    WHEN height > 15 THEN 'high_forest'
                END as canopy_class,
                COUNT(*) as pixel_count,
                AVG(height) as avg_height
            FROM all_pixels, boundary
            WHERE ST_Contains(boundary.geom, ST_Centroid(pixel_center))
              AND height IS NOT NULL
              AND height >= 0
              AND height <= 50
            GROUP BY canopy_class

2026-02-07 14:32:24,981 INFO sqlalchemy.engine.Engine [generated in 0.00027s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,058 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as agb_mean,
                (stats).sum as agb_total
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, 1, ST_GeomFromText(%(wkt)s, 4326)),
                    1,  -- band 1
                    true  -- exclude nodata
                ) as stats
                FROM rasters.agb_2022_nepal
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ) as subquery

2026-02-07 14:32:25,058 INFO sqlalchemy.engine.Engine [generated in 0.00040s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,075 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as health_class,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_forest_health
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 5
            GROUP BY health_class

2026-02-07 14:32:25,075 INFO sqlalchemy.engine.Engine [generated in 0.00062s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,098 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as forest_type_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_type WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 26
            GROUP BY forest_type_code ORDER BY pixel_count DESC

2026-02-07 14:32:25,099 INFO sqlalchemy.engine.Engine [generated in 0.00055s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,120 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as landcover_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.esa_world_cover WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
            GROUP BY landcover_code ORDER BY pixel_count DESC

2026-02-07 14:32:25,120 INFO sqlalchemy.engine.Engine [generated in 0.00029s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,131 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as loss_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_lossyear WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY loss_year ORDER BY loss_year

2026-02-07 14:32:25,131 INFO sqlalchemy.engine.Engine [generated in 0.00049s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,146 INFO sqlalchemy.engine.Engine
            SELECT SUM((pvc).count) as gain_pixels
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_gain WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value = 1

2026-02-07 14:32:25,146 INFO sqlalchemy.engine.Engine [generated in 0.00034s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,159 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as fire_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_loss_fire WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY fire_year ORDER BY fire_year

2026-02-07 14:32:25,159 INFO sqlalchemy.engine.Engine [generated in 0.00049s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,169 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_mean_temperature WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_mean FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:32:25,169 INFO sqlalchemy.engine.Engine [generated in 0.00032s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,180 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.min_temp_coldest_month WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_min FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:32:25,180 INFO sqlalchemy.engine.Engine [generated in 0.00033s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,191 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_precipitation WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as precip FROM clipped
            )
            SELECT AVG(precip) as precip_mean FROM pixel_values WHERE precip IS NOT NULL AND precip >= 0

2026-02-07 14:32:25,191 INFO sqlalchemy.engine.Engine [generated in 0.00040s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,202 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as texture_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.soilgrids_isric WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 12
            GROUP BY texture_code ORDER BY pixel_count DESC LIMIT 1

2026-02-07 14:32:25,202 INFO sqlalchemy.engine.Engine [generated in 0.00028s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,230 INFO sqlalchemy.engine.Engine
        SELECT p.province
        FROM admin.province p
        WHERE ST_Intersects(
            p.shape,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:25,230 INFO sqlalchemy.engine.Engine [generated in 0.00042s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,251 INFO sqlalchemy.engine.Engine
        SELECT m.district, m.gapa_napa as municipality
        FROM admin.municipality m
        WHERE ST_Intersects(
            m.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:25,251 INFO sqlalchemy.engine.Engine [generated in 0.00058s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,270 INFO sqlalchemy.engine.Engine
        SELECT w.ward
        FROM admin.ward w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:25,271 INFO sqlalchemy.engine.Engine [generated in 0.00040s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,281 INFO sqlalchemy.engine.Engine
        SELECT w."watershed name" as watershed_name, w."major river basin" as major_river_basin
        FROM admin."watershed_Nepal" w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:25,281 INFO sqlalchemy.engine.Engine [generated in 0.00050s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,304 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
        ),
        total_area AS (
            SELECT ST_Area(ST_Transform(geom, 32645)) as area
            FROM input_geom
        ),
        geology_intersections AS (
            SELECT
                g."geology class" as geology_class,
                ST_Area(
                    ST_Transform(
                        ST_Intersection(g.geom, i.geom),
                        32645
                    )
                ) as intersection_area
            FROM geology.geology g, input_geom i
            WHERE ST_Intersects(g.geom, i.geom)
            AND g."geology class" IS NOT NULL
            AND g."geology class" != 'No Data'
        )
        SELECT
            geology_class,
            (intersection_area / (SELECT area FROM total_area)) * 100 as percentage
        FROM geology_intersections
        WHERE intersection_area > 0
        ORDER BY percentage DESC

2026-02-07 14:32:25,304 INFO sqlalchemy.engine.Engine [generated in 0.00076s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:25,392 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT
                ST_GeomFromText(%(wkt)s, 4326) as geom,
                ST_Centroid(ST_GeomFromText(%(wkt)s, 4326)) as centroid
        ),
        nearest_hq AS (
            SELECT
                dh."head quarter" as name,
                ST_Distance(
                    ST_Transform(i.centroid, 32645),
                    ST_Transform(dh.geom, 32645)
                ) / 1000.0 as distance_km,
                degrees(
                    ST_Azimuth(
                        i.centroid,
                        dh.geom
                    )
                ) as azimuth_degrees
            FROM admin."district Headquarter" dh, input_geom i
            WHERE dh."head quarter" IS NOT NULL
            ORDER BY ST_Distance(i.centroid, dh.geom)
            LIMIT 1
        )
        SELECT
            name,
            distance_km,
            azimuth_degrees,
            CASE
                WHEN azimuth_degrees >= 337.5 OR azimuth_degrees < 22.5 THEN 'North'
                WHEN azimuth_degrees >= 22.5 AND azimuth_degrees < 67.5 THEN 'Northeast'
                WHEN azimuth_degrees >= 67.5 AND azimuth_degrees < 112.5 THEN 'East'
                WHEN azimuth_degrees >= 112.5 AND azimuth_degrees < 157.5 THEN 'Southeast'
                WHEN azimuth_degrees >= 157.5 AND azimuth_degrees < 202.5 THEN 'South'
                WHEN azimuth_degrees >= 202.5 AND azimuth_degrees < 247.5 THEN 'Southwest'
                WHEN azimuth_degrees >= 247.5 AND azimuth_degrees < 292.5 THEN 'West'
                ELSE 'Northwest'
            END as direction
        FROM nearest_hq

2026-02-07 14:32:25,392 INFO sqlalchemy.engine.Engine [generated in 0.00062s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
  Calling analyze_nearby_features...
  Calling PostgreSQL analyze_nearby_features function...
2026-02-07 14:32:25,401 INFO sqlalchemy.engine.Engine SAVEPOINT sa_savepoint_1
2026-02-07 14:32:25,402 INFO sqlalchemy.engine.Engine [no key 0.00047s] {}
2026-02-07 14:32:25,403 INFO sqlalchemy.engine.Engine
            SELECT analyze_nearby_features(%(wkt)s)

2026-02-07 14:32:25,403 INFO sqlalchemy.engine.Engine [generated in 0.00029s] {'wkt': 'POLYGON((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593286500 ... (744 characters truncated) ... 888,85.04257172464541 27.45104893711257,85.04167562347398 27.45166959637476,85.04075765321187 27.45207690464419,85.0400647996589 27.452510086609063))'}
2026-02-07 14:32:57,986 INFO sqlalchemy.engine.Engine RELEASE SAVEPOINT sa_savepoint_1
2026-02-07 14:32:57,986 INFO sqlalchemy.engine.Engine [no key 0.00041s] {}
  PostgreSQL function returned all 4 directions:
    features_north: residential: NE(23) 0m, unclassified: N(347) 0m,
    features_east: River/Strem Flow Line: NE(64) 0m, service: E(87)
    features_south: Nishankhoriya: S(198) 0m, Kusumdanda: SE(142) 99
    features_west: path: NW(305) 0m, Shri Barahi Ni Ma V: W(280) 50
  analyze_nearby_features returned: ['features_north', 'features_east', 'features_south', 'features_west']
  Features: N=residential: NE(23) 0m, unclassified: N(347) 0m, Suparitar: N(2) 0m, E=River/Strem Flow Line: NE(64) 0m, service: E(87) 40m, track: SE(130) 64m, S=Nishankhoriya: S(198) 0m, Kusumdanda: SE(142) 996m, Chaukltol: SW(220) 1045m, W=path: NW(305) 0m, Shri Barahi Ni Ma V: W(280) 505m, Maintar: NW(295) 851m
  After update, block_results has keys: ['wkt', 'extent', 'elevation_min_m', 'elevation_max_m', 'elevation_mean_m', 'slope_dominant_class', 'slope_percentages', 'aspect_dominant', 'aspect_percentages', 'canopy_mean_m', 'canopy_dominant_class', 'canopy_percentages', 'agb_mean_mg_ha', 'agb_total_mg', 'carbon_stock_mg', 'forest_health_dominant', 'forest_health_percentages', 'forest_type_dominant', 'forest_type_percentages', 'landcover_dominant', 'landcover_percentages', 'forest_loss_hectares', 'forest_loss_by_year', 'forest_gain_hectares', 'fire_loss_hectares', 'fire_loss_by_year', 'temperature_mean_c', 'temperature_min_c', 'precipitation_mean_mm', 'soil_texture', 'province', 'district', 'municipality', 'ward', 'watershed', 'major_river_basin', 'geology_percentages', 'access_info', 'features_north', 'features_east', 'features_south', 'features_west']
Block 1 analysis completed successfully
2026-02-07 14:32:57,989 INFO sqlalchemy.engine.Engine COMMIT
Block 1 transaction committed
Analyzing block 2/5: Tridevi
2026-02-07 14:32:57,991 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:32:57,991 INFO sqlalchemy.engine.Engine
            SELECT ST_AsText(ST_GeomFromGeoJSON(%(geojson)s)) as wkt

2026-02-07 14:32:57,992 INFO sqlalchemy.engine.Engine [cached since 33.28s ago] {'geojson': '{"type": "Polygon", "coordinates": [[[85.047995387267, 27.445819641657238], [85.04715710600006, 27.44543162300008], [85.04719502200011, 27.4438751490 ... (693 characters truncated) ... 25420544, 27.44564814142084], [85.0465058433868, 27.44540721889353], [85.04772748767063, 27.44588899168252], [85.047995387267, 27.445819641657238]]]}'}
2026-02-07 14:32:57,994 INFO sqlalchemy.engine.Engine
        SELECT
            ST_YMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as north,
            ST_YMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as south,
            ST_XMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as east,
            ST_XMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as west

2026-02-07 14:32:57,994 INFO sqlalchemy.engine.Engine [cached since 33.28s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:57,996 INFO sqlalchemy.engine.Engine
            WITH clipped_raster AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.dem
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ),
            pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as elevation
                FROM clipped_raster
            )
            SELECT
                MIN(elevation) as elevation_min,
                MAX(elevation) as elevation_max,
                AVG(elevation) as elevation_mean
            FROM pixel_values
            WHERE elevation > -32000  -- Exclude NoData values (-32768)
              AND elevation >= 0       -- Nepal minimum elevation
              AND elevation <= 9000    -- Nepal maximum elevation

2026-02-07 14:32:57,996 INFO sqlalchemy.engine.Engine [cached since 33.27s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,051 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as slope_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.slope
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value > 0
              AND (pvc).value <= 4
            GROUP BY slope_code

2026-02-07 14:32:58,051 INFO sqlalchemy.engine.Engine [cached since 33.11s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,056 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as aspect_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.aspect
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 0 AND 8
            GROUP BY aspect_code

2026-02-07 14:32:58,057 INFO sqlalchemy.engine.Engine [cached since 33.09s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,063 INFO sqlalchemy.engine.Engine
            WITH boundary AS (
                SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
            ),
            all_pixels AS (
                SELECT
                    (pix).val as height,
                    (pix).geom as pixel_center
                FROM (
                    SELECT ST_PixelAsPolygons(rast) as pix
                    FROM rasters.canopy_height, boundary
                    WHERE ST_Intersects(rast, geom)
                ) as subq
            )
            SELECT
                CASE
                    WHEN height = 0 THEN 'non_forest'
                    WHEN height > 0 AND height <= 5 THEN 'bush_regenerated'
                    WHEN height > 5 AND height <= 15 THEN 'pole_trees'
                    WHEN height > 15 THEN 'high_forest'
                END as canopy_class,
                COUNT(*) as pixel_count,
                AVG(height) as avg_height
            FROM all_pixels, boundary
            WHERE ST_Contains(boundary.geom, ST_Centroid(pixel_center))
              AND height IS NOT NULL
              AND height >= 0
              AND height <= 50
            GROUP BY canopy_class

2026-02-07 14:32:58,064 INFO sqlalchemy.engine.Engine [cached since 33.08s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,156 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as agb_mean,
                (stats).sum as agb_total
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, 1, ST_GeomFromText(%(wkt)s, 4326)),
                    1,  -- band 1
                    true  -- exclude nodata
                ) as stats
                FROM rasters.agb_2022_nepal
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ) as subquery

2026-02-07 14:32:58,156 INFO sqlalchemy.engine.Engine [cached since 33.1s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,162 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as health_class,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_forest_health
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 5
            GROUP BY health_class

2026-02-07 14:32:58,163 INFO sqlalchemy.engine.Engine [cached since 33.09s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,170 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as forest_type_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_type WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 26
            GROUP BY forest_type_code ORDER BY pixel_count DESC

2026-02-07 14:32:58,170 INFO sqlalchemy.engine.Engine [cached since 33.07s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,177 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as landcover_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.esa_world_cover WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
            GROUP BY landcover_code ORDER BY pixel_count DESC

2026-02-07 14:32:58,177 INFO sqlalchemy.engine.Engine [cached since 33.06s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,187 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as loss_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_lossyear WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY loss_year ORDER BY loss_year

2026-02-07 14:32:58,187 INFO sqlalchemy.engine.Engine [cached since 33.06s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,198 INFO sqlalchemy.engine.Engine
            SELECT SUM((pvc).count) as gain_pixels
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_gain WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value = 1

2026-02-07 14:32:58,198 INFO sqlalchemy.engine.Engine [cached since 33.05s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,206 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as fire_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_loss_fire WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY fire_year ORDER BY fire_year

2026-02-07 14:32:58,207 INFO sqlalchemy.engine.Engine [cached since 33.05s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,212 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_mean_temperature WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_mean FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:32:58,212 INFO sqlalchemy.engine.Engine [cached since 33.04s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,220 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.min_temp_coldest_month WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_min FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:32:58,220 INFO sqlalchemy.engine.Engine [cached since 33.04s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,226 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_precipitation WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as precip FROM clipped
            )
            SELECT AVG(precip) as precip_mean FROM pixel_values WHERE precip IS NOT NULL AND precip >= 0

2026-02-07 14:32:58,226 INFO sqlalchemy.engine.Engine [cached since 33.04s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,231 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as texture_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.soilgrids_isric WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 12
            GROUP BY texture_code ORDER BY pixel_count DESC LIMIT 1

2026-02-07 14:32:58,231 INFO sqlalchemy.engine.Engine [cached since 33.03s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,238 INFO sqlalchemy.engine.Engine
        SELECT p.province
        FROM admin.province p
        WHERE ST_Intersects(
            p.shape,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:58,238 INFO sqlalchemy.engine.Engine [cached since 33.01s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,242 INFO sqlalchemy.engine.Engine
        SELECT m.district, m.gapa_napa as municipality
        FROM admin.municipality m
        WHERE ST_Intersects(
            m.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:58,243 INFO sqlalchemy.engine.Engine [cached since 32.99s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,247 INFO sqlalchemy.engine.Engine
        SELECT w.ward
        FROM admin.ward w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:58,247 INFO sqlalchemy.engine.Engine [cached since 32.98s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,253 INFO sqlalchemy.engine.Engine
        SELECT w."watershed name" as watershed_name, w."major river basin" as major_river_basin
        FROM admin."watershed_Nepal" w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:32:58,254 INFO sqlalchemy.engine.Engine [cached since 32.97s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,261 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
        ),
        total_area AS (
            SELECT ST_Area(ST_Transform(geom, 32645)) as area
            FROM input_geom
        ),
        geology_intersections AS (
            SELECT
                g."geology class" as geology_class,
                ST_Area(
                    ST_Transform(
                        ST_Intersection(g.geom, i.geom),
                        32645
                    )
                ) as intersection_area
            FROM geology.geology g, input_geom i
            WHERE ST_Intersects(g.geom, i.geom)
            AND g."geology class" IS NOT NULL
            AND g."geology class" != 'No Data'
        )
        SELECT
            geology_class,
            (intersection_area / (SELECT area FROM total_area)) * 100 as percentage
        FROM geology_intersections
        WHERE intersection_area > 0
        ORDER BY percentage DESC

2026-02-07 14:32:58,261 INFO sqlalchemy.engine.Engine [cached since 32.96s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:32:58,299 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT
                ST_GeomFromText(%(wkt)s, 4326) as geom,
                ST_Centroid(ST_GeomFromText(%(wkt)s, 4326)) as centroid
        ),
        nearest_hq AS (
            SELECT
                dh."head quarter" as name,
                ST_Distance(
                    ST_Transform(i.centroid, 32645),
                    ST_Transform(dh.geom, 32645)
                ) / 1000.0 as distance_km,
                degrees(
                    ST_Azimuth(
                        i.centroid,
                        dh.geom
                    )
                ) as azimuth_degrees
            FROM admin."district Headquarter" dh, input_geom i
            WHERE dh."head quarter" IS NOT NULL
            ORDER BY ST_Distance(i.centroid, dh.geom)
            LIMIT 1
        )
        SELECT
            name,
            distance_km,
            azimuth_degrees,
            CASE
                WHEN azimuth_degrees >= 337.5 OR azimuth_degrees < 22.5 THEN 'North'
                WHEN azimuth_degrees >= 22.5 AND azimuth_degrees < 67.5 THEN 'Northeast'
                WHEN azimuth_degrees >= 67.5 AND azimuth_degrees < 112.5 THEN 'East'
                WHEN azimuth_degrees >= 112.5 AND azimuth_degrees < 157.5 THEN 'Southeast'
                WHEN azimuth_degrees >= 157.5 AND azimuth_degrees < 202.5 THEN 'South'
                WHEN azimuth_degrees >= 202.5 AND azimuth_degrees < 247.5 THEN 'Southwest'
                WHEN azimuth_degrees >= 247.5 AND azimuth_degrees < 292.5 THEN 'West'
                ELSE 'Northwest'
            END as direction
        FROM nearest_hq

2026-02-07 14:32:58,300 INFO sqlalchemy.engine.Engine [cached since 32.91s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
  Calling analyze_nearby_features...
  Calling PostgreSQL analyze_nearby_features function...
2026-02-07 14:32:58,305 INFO sqlalchemy.engine.Engine SAVEPOINT sa_savepoint_1
2026-02-07 14:32:58,306 INFO sqlalchemy.engine.Engine [no key 0.00040s] {}
2026-02-07 14:32:58,306 INFO sqlalchemy.engine.Engine
            SELECT analyze_nearby_features(%(wkt)s)

2026-02-07 14:32:58,307 INFO sqlalchemy.engine.Engine [cached since 32.9s ago] {'wkt': 'POLYGON((85.047995387267 27.445819641657238,85.04715710600006 27.44543162300008,85.04719502200011 27.44387514900008,85.0470983342928 27.4429358340044 ... (569 characters truncated) ... 41904,85.04579325420544 27.44564814142084,85.0465058433868 27.44540721889353,85.04772748767063 27.44588899168252,85.047995387267 27.445819641657238))'}
2026-02-07 14:33:45,466 INFO sqlalchemy.engine.Engine RELEASE SAVEPOINT sa_savepoint_1
2026-02-07 14:33:45,466 INFO sqlalchemy.engine.Engine [no key 0.00033s] {}
  PostgreSQL function returned all 4 directions:
    features_north: unclassified: NE(41) 188m, service: NE(24) 386m,
    features_east: Nishankhoriya: NE(52) 0m, Kusumtar: E(100) 1411m
    features_south: path: SE(141) 0m, track: S(182) 0m, Kusumdanda:
    features_west: Chaukltol: W(265) 0m, River/Strem Flow Line: W(27
  analyze_nearby_features returned: ['features_north', 'features_east', 'features_south', 'features_west']
  Features: N=unclassified: NE(41) 188m, service: NE(24) 386m, residential: N(12) 400m, E=Nishankhoriya: NE(52) 0m, Kusumtar: E(100) 1411m, Manakamana: SE(126) 1787m, S=path: SE(141) 0m, track: S(182) 0m, Kusumdanda: S(176) 0m, W=Chaukltol: W(265) 0m, River/Strem Flow Line: W(272) 0m, Shri Barahi Ni Ma V: NW(306) 789m
  After update, block_results has keys: ['wkt', 'extent', 'elevation_min_m', 'elevation_max_m', 'elevation_mean_m', 'slope_dominant_class', 'slope_percentages', 'aspect_dominant', 'aspect_percentages', 'canopy_mean_m', 'canopy_dominant_class', 'canopy_percentages', 'agb_mean_mg_ha', 'agb_total_mg', 'carbon_stock_mg', 'forest_health_dominant', 'forest_health_percentages', 'forest_type_dominant', 'forest_type_percentages', 'landcover_dominant', 'landcover_percentages', 'forest_loss_hectares', 'forest_loss_by_year', 'forest_gain_hectares', 'fire_loss_hectares', 'fire_loss_by_year', 'temperature_mean_c', 'temperature_min_c', 'precipitation_mean_mm', 'soil_texture', 'province', 'district', 'municipality', 'ward', 'watershed', 'major_river_basin', 'geology_percentages', 'access_info', 'features_north', 'features_east', 'features_south', 'features_west']
Block 2 analysis completed successfully
2026-02-07 14:33:45,468 INFO sqlalchemy.engine.Engine COMMIT
Block 2 transaction committed
Analyzing block 3/5: Dulal gauda
2026-02-07 14:33:45,470 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:33:45,470 INFO sqlalchemy.engine.Engine
            SELECT ST_AsText(ST_GeomFromGeoJSON(%(geojson)s)) as wkt

2026-02-07 14:33:45,471 INFO sqlalchemy.engine.Engine [cached since 80.76s ago] {'geojson': '{"type": "Polygon", "coordinates": [[[85.04289999416446, 27.443298465963665], [85.04185512700013, 27.44316105200006], [85.04089022700003, 27.44267943 ... (1090 characters truncated) ... 970049, 27.44658804787176], [85.04281209144922, 27.44474551114931], [85.0427028155171, 27.44358179062334], [85.04289999416446, 27.443298465963665]]]}'}
2026-02-07 14:33:45,472 INFO sqlalchemy.engine.Engine
        SELECT
            ST_YMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as north,
            ST_YMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as south,
            ST_XMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as east,
            ST_XMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as west

2026-02-07 14:33:45,472 INFO sqlalchemy.engine.Engine [cached since 80.75s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,473 INFO sqlalchemy.engine.Engine
            WITH clipped_raster AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.dem
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ),
            pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as elevation
                FROM clipped_raster
            )
            SELECT
                MIN(elevation) as elevation_min,
                MAX(elevation) as elevation_max,
                AVG(elevation) as elevation_mean
            FROM pixel_values
            WHERE elevation > -32000  -- Exclude NoData values (-32768)
              AND elevation >= 0       -- Nepal minimum elevation
              AND elevation <= 9000    -- Nepal maximum elevation

2026-02-07 14:33:45,474 INFO sqlalchemy.engine.Engine [cached since 80.74s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,483 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as slope_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.slope
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value > 0
              AND (pvc).value <= 4
            GROUP BY slope_code

2026-02-07 14:33:45,484 INFO sqlalchemy.engine.Engine [cached since 80.54s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,488 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as aspect_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.aspect
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 0 AND 8
            GROUP BY aspect_code

2026-02-07 14:33:45,488 INFO sqlalchemy.engine.Engine [cached since 80.53s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,492 INFO sqlalchemy.engine.Engine
            WITH boundary AS (
                SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
            ),
            all_pixels AS (
                SELECT
                    (pix).val as height,
                    (pix).geom as pixel_center
                FROM (
                    SELECT ST_PixelAsPolygons(rast) as pix
                    FROM rasters.canopy_height, boundary
                    WHERE ST_Intersects(rast, geom)
                ) as subq
            )
            SELECT
                CASE
                    WHEN height = 0 THEN 'non_forest'
                    WHEN height > 0 AND height <= 5 THEN 'bush_regenerated'
                    WHEN height > 5 AND height <= 15 THEN 'pole_trees'
                    WHEN height > 15 THEN 'high_forest'
                END as canopy_class,
                COUNT(*) as pixel_count,
                AVG(height) as avg_height
            FROM all_pixels, boundary
            WHERE ST_Contains(boundary.geom, ST_Centroid(pixel_center))
              AND height IS NOT NULL
              AND height >= 0
              AND height <= 50
            GROUP BY canopy_class

2026-02-07 14:33:45,493 INFO sqlalchemy.engine.Engine [cached since 80.51s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,549 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as agb_mean,
                (stats).sum as agb_total
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, 1, ST_GeomFromText(%(wkt)s, 4326)),
                    1,  -- band 1
                    true  -- exclude nodata
                ) as stats
                FROM rasters.agb_2022_nepal
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ) as subquery

2026-02-07 14:33:45,549 INFO sqlalchemy.engine.Engine [cached since 80.49s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,552 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as health_class,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_forest_health
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 5
            GROUP BY health_class

2026-02-07 14:33:45,552 INFO sqlalchemy.engine.Engine [cached since 80.48s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,557 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as forest_type_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_type WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 26
            GROUP BY forest_type_code ORDER BY pixel_count DESC

2026-02-07 14:33:45,558 INFO sqlalchemy.engine.Engine [cached since 80.46s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,561 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as landcover_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.esa_world_cover WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
            GROUP BY landcover_code ORDER BY pixel_count DESC

2026-02-07 14:33:45,561 INFO sqlalchemy.engine.Engine [cached since 80.44s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,564 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as loss_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_lossyear WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY loss_year ORDER BY loss_year

2026-02-07 14:33:45,565 INFO sqlalchemy.engine.Engine [cached since 80.43s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,567 INFO sqlalchemy.engine.Engine
            SELECT SUM((pvc).count) as gain_pixels
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_gain WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value = 1

2026-02-07 14:33:45,567 INFO sqlalchemy.engine.Engine [cached since 80.42s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,569 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as fire_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_loss_fire WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY fire_year ORDER BY fire_year

2026-02-07 14:33:45,569 INFO sqlalchemy.engine.Engine [cached since 80.41s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,571 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_mean_temperature WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_mean FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:33:45,572 INFO sqlalchemy.engine.Engine [cached since 80.4s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,574 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.min_temp_coldest_month WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_min FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:33:45,574 INFO sqlalchemy.engine.Engine [cached since 80.39s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,579 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_precipitation WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as precip FROM clipped
            )
            SELECT AVG(precip) as precip_mean FROM pixel_values WHERE precip IS NOT NULL AND precip >= 0

2026-02-07 14:33:45,579 INFO sqlalchemy.engine.Engine [cached since 80.39s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,585 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as texture_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.soilgrids_isric WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 12
            GROUP BY texture_code ORDER BY pixel_count DESC LIMIT 1

2026-02-07 14:33:45,586 INFO sqlalchemy.engine.Engine [cached since 80.38s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,594 INFO sqlalchemy.engine.Engine
        SELECT p.province
        FROM admin.province p
        WHERE ST_Intersects(
            p.shape,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:33:45,595 INFO sqlalchemy.engine.Engine [cached since 80.37s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,602 INFO sqlalchemy.engine.Engine
        SELECT m.district, m.gapa_napa as municipality
        FROM admin.municipality m
        WHERE ST_Intersects(
            m.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:33:45,603 INFO sqlalchemy.engine.Engine [cached since 80.35s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,606 INFO sqlalchemy.engine.Engine
        SELECT w.ward
        FROM admin.ward w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:33:45,607 INFO sqlalchemy.engine.Engine [cached since 80.34s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,611 INFO sqlalchemy.engine.Engine
        SELECT w."watershed name" as watershed_name, w."major river basin" as major_river_basin
        FROM admin."watershed_Nepal" w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:33:45,611 INFO sqlalchemy.engine.Engine [cached since 80.33s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,615 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
        ),
        total_area AS (
            SELECT ST_Area(ST_Transform(geom, 32645)) as area
            FROM input_geom
        ),
        geology_intersections AS (
            SELECT
                g."geology class" as geology_class,
                ST_Area(
                    ST_Transform(
                        ST_Intersection(g.geom, i.geom),
                        32645
                    )
                ) as intersection_area
            FROM geology.geology g, input_geom i
            WHERE ST_Intersects(g.geom, i.geom)
            AND g."geology class" IS NOT NULL
            AND g."geology class" != 'No Data'
        )
        SELECT
            geology_class,
            (intersection_area / (SELECT area FROM total_area)) * 100 as percentage
        FROM geology_intersections
        WHERE intersection_area > 0
        ORDER BY percentage DESC

2026-02-07 14:33:45,615 INFO sqlalchemy.engine.Engine [cached since 80.31s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:33:45,625 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT
                ST_GeomFromText(%(wkt)s, 4326) as geom,
                ST_Centroid(ST_GeomFromText(%(wkt)s, 4326)) as centroid
        ),
        nearest_hq AS (
            SELECT
                dh."head quarter" as name,
                ST_Distance(
                    ST_Transform(i.centroid, 32645),
                    ST_Transform(dh.geom, 32645)
                ) / 1000.0 as distance_km,
                degrees(
                    ST_Azimuth(
                        i.centroid,
                        dh.geom
                    )
                ) as azimuth_degrees
            FROM admin."district Headquarter" dh, input_geom i
            WHERE dh."head quarter" IS NOT NULL
            ORDER BY ST_Distance(i.centroid, dh.geom)
            LIMIT 1
        )
        SELECT
            name,
            distance_km,
            azimuth_degrees,
            CASE
                WHEN azimuth_degrees >= 337.5 OR azimuth_degrees < 22.5 THEN 'North'
                WHEN azimuth_degrees >= 22.5 AND azimuth_degrees < 67.5 THEN 'Northeast'
                WHEN azimuth_degrees >= 67.5 AND azimuth_degrees < 112.5 THEN 'East'
                WHEN azimuth_degrees >= 112.5 AND azimuth_degrees < 157.5 THEN 'Southeast'
                WHEN azimuth_degrees >= 157.5 AND azimuth_degrees < 202.5 THEN 'South'
                WHEN azimuth_degrees >= 202.5 AND azimuth_degrees < 247.5 THEN 'Southwest'
                WHEN azimuth_degrees >= 247.5 AND azimuth_degrees < 292.5 THEN 'West'
                ELSE 'Northwest'
            END as direction
        FROM nearest_hq

2026-02-07 14:33:45,626 INFO sqlalchemy.engine.Engine [cached since 80.23s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
  Calling analyze_nearby_features...
  Calling PostgreSQL analyze_nearby_features function...
2026-02-07 14:33:45,631 INFO sqlalchemy.engine.Engine SAVEPOINT sa_savepoint_1
2026-02-07 14:33:45,631 INFO sqlalchemy.engine.Engine [no key 0.00052s] {}
2026-02-07 14:33:45,633 INFO sqlalchemy.engine.Engine
            SELECT analyze_nearby_features(%(wkt)s)

2026-02-07 14:33:45,633 INFO sqlalchemy.engine.Engine [cached since 80.23s ago] {'wkt': 'POLYGON((85.04289999416446 27.443298465963665,85.04185512700013 27.44316105200006,85.04089022700003 27.44267943900006,85.0404909366054 27.44237826331 ... (926 characters truncated) ... 37399,85.042680970049 27.44658804787176,85.04281209144922 27.44474551114931,85.0427028155171 27.44358179062334,85.04289999416446 27.443298465963665))'}
2026-02-07 14:34:32,431 INFO sqlalchemy.engine.Engine RELEASE SAVEPOINT sa_savepoint_1
2026-02-07 14:34:32,431 INFO sqlalchemy.engine.Engine [no key 0.00042s] {}
  PostgreSQL function returned all 4 directions:
    features_north: path: N(1) 101m, Maintar: NW(318) 850m, Suparita
    features_east: Nishankhoriya: E(77) 994m, Kusumdanda: SE(123) 1
    features_south: River/Strem Flow Line: S(185) 0m, Chaukltol: SE(1
    features_west: residential: W(255) 44m, service: SW(236) 84m, u
  analyze_nearby_features returned: ['features_north', 'features_east', 'features_south', 'features_west']
  Features: N=path: N(1) 101m, Maintar: NW(318) 850m, Suparitar: N(11) 858m, E=Nishankhoriya: E(77) 994m, Kusumdanda: SE(123) 1204m, Kusumtar: E(103) 1861m, S=River/Strem Flow Line: S(185) 0m, Chaukltol: SE(147) 0m, track: SE(153) 0m, W=residential: W(255) 44m, service: SW(236) 84m, unclassified: W(289) 131m
  After update, block_results has keys: ['wkt', 'extent', 'elevation_min_m', 'elevation_max_m', 'elevation_mean_m', 'slope_dominant_class', 'slope_percentages', 'aspect_dominant', 'aspect_percentages', 'canopy_mean_m', 'canopy_dominant_class', 'canopy_percentages', 'agb_mean_mg_ha', 'agb_total_mg', 'carbon_stock_mg', 'forest_health_dominant', 'forest_health_percentages', 'forest_type_dominant', 'forest_type_percentages', 'landcover_dominant', 'landcover_percentages', 'forest_loss_hectares', 'forest_loss_by_year', 'forest_gain_hectares', 'fire_loss_hectares', 'fire_loss_by_year', 'temperature_mean_c', 'temperature_min_c', 'precipitation_mean_mm', 'soil_texture', 'province', 'district', 'municipality', 'ward', 'watershed', 'major_river_basin', 'geology_percentages', 'access_info', 'features_north', 'features_east', 'features_south', 'features_west']
Block 3 analysis completed successfully
2026-02-07 14:34:32,434 INFO sqlalchemy.engine.Engine COMMIT
Block 3 transaction committed
Analyzing block 4/5: Panchanga
2026-02-07 14:34:32,436 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:34:32,437 INFO sqlalchemy.engine.Engine
            SELECT ST_AsText(ST_GeomFromGeoJSON(%(geojson)s)) as wkt

2026-02-07 14:34:32,437 INFO sqlalchemy.engine.Engine [cached since 127.7s ago] {'geojson': '{"type": "Polygon", "coordinates": [[[85.03717209456956, 27.4452210961317], [85.03726984000008, 27.44632338700005], [85.03776562100006, 27.4487934220 ... (414 characters truncated) ... 651313292, 27.44540435536751], [85.03790244868908, 27.4453104160841], [85.03747910038179, 27.4452298955167], [85.03717209456956, 27.4452210961317]]]}'}
2026-02-07 14:34:32,439 INFO sqlalchemy.engine.Engine
        SELECT
            ST_YMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as north,
            ST_YMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as south,
            ST_XMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as east,
            ST_XMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as west

2026-02-07 14:34:32,439 INFO sqlalchemy.engine.Engine [cached since 127.7s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,442 INFO sqlalchemy.engine.Engine
            WITH clipped_raster AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.dem
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ),
            pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as elevation
                FROM clipped_raster
            )
            SELECT
                MIN(elevation) as elevation_min,
                MAX(elevation) as elevation_max,
                AVG(elevation) as elevation_mean
            FROM pixel_values
            WHERE elevation > -32000  -- Exclude NoData values (-32768)
              AND elevation >= 0       -- Nepal minimum elevation
              AND elevation <= 9000    -- Nepal maximum elevation

2026-02-07 14:34:32,442 INFO sqlalchemy.engine.Engine [cached since 127.7s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,448 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as slope_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.slope
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value > 0
              AND (pvc).value <= 4
            GROUP BY slope_code

2026-02-07 14:34:32,449 INFO sqlalchemy.engine.Engine [cached since 127.5s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,451 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as aspect_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.aspect
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 0 AND 8
            GROUP BY aspect_code

2026-02-07 14:34:32,452 INFO sqlalchemy.engine.Engine [cached since 127.5s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,454 INFO sqlalchemy.engine.Engine
            WITH boundary AS (
                SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
            ),
            all_pixels AS (
                SELECT
                    (pix).val as height,
                    (pix).geom as pixel_center
                FROM (
                    SELECT ST_PixelAsPolygons(rast) as pix
                    FROM rasters.canopy_height, boundary
                    WHERE ST_Intersects(rast, geom)
                ) as subq
            )
            SELECT
                CASE
                    WHEN height = 0 THEN 'non_forest'
                    WHEN height > 0 AND height <= 5 THEN 'bush_regenerated'
                    WHEN height > 5 AND height <= 15 THEN 'pole_trees'
                    WHEN height > 15 THEN 'high_forest'
                END as canopy_class,
                COUNT(*) as pixel_count,
                AVG(height) as avg_height
            FROM all_pixels, boundary
            WHERE ST_Contains(boundary.geom, ST_Centroid(pixel_center))
              AND height IS NOT NULL
              AND height >= 0
              AND height <= 50
            GROUP BY canopy_class

2026-02-07 14:34:32,455 INFO sqlalchemy.engine.Engine [cached since 127.5s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,500 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as agb_mean,
                (stats).sum as agb_total
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, 1, ST_GeomFromText(%(wkt)s, 4326)),
                    1,  -- band 1
                    true  -- exclude nodata
                ) as stats
                FROM rasters.agb_2022_nepal
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ) as subquery

2026-02-07 14:34:32,500 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,502 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as health_class,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_forest_health
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 5
            GROUP BY health_class

2026-02-07 14:34:32,502 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,506 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as forest_type_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_type WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 26
            GROUP BY forest_type_code ORDER BY pixel_count DESC

2026-02-07 14:34:32,506 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,509 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as landcover_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.esa_world_cover WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
            GROUP BY landcover_code ORDER BY pixel_count DESC

2026-02-07 14:34:32,510 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,514 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as loss_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_lossyear WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY loss_year ORDER BY loss_year

2026-02-07 14:34:32,514 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,516 INFO sqlalchemy.engine.Engine
            SELECT SUM((pvc).count) as gain_pixels
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_gain WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value = 1

2026-02-07 14:34:32,517 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,519 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as fire_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_loss_fire WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY fire_year ORDER BY fire_year

2026-02-07 14:34:32,519 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,521 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_mean_temperature WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_mean FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:34:32,522 INFO sqlalchemy.engine.Engine [cached since 127.4s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,524 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.min_temp_coldest_month WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_min FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:34:32,525 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,528 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_precipitation WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as precip FROM clipped
            )
            SELECT AVG(precip) as precip_mean FROM pixel_values WHERE precip IS NOT NULL AND precip >= 0

2026-02-07 14:34:32,529 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,531 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as texture_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.soilgrids_isric WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 12
            GROUP BY texture_code ORDER BY pixel_count DESC LIMIT 1

2026-02-07 14:34:32,532 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,536 INFO sqlalchemy.engine.Engine
        SELECT p.province
        FROM admin.province p
        WHERE ST_Intersects(
            p.shape,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:34:32,536 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,539 INFO sqlalchemy.engine.Engine
        SELECT m.district, m.gapa_napa as municipality
        FROM admin.municipality m
        WHERE ST_Intersects(
            m.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:34:32,539 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,542 INFO sqlalchemy.engine.Engine
        SELECT w.ward
        FROM admin.ward w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:34:32,543 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,546 INFO sqlalchemy.engine.Engine
        SELECT w."watershed name" as watershed_name, w."major river basin" as major_river_basin
        FROM admin."watershed_Nepal" w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:34:32,547 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,549 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
        ),
        total_area AS (
            SELECT ST_Area(ST_Transform(geom, 32645)) as area
            FROM input_geom
        ),
        geology_intersections AS (
            SELECT
                g."geology class" as geology_class,
                ST_Area(
                    ST_Transform(
                        ST_Intersection(g.geom, i.geom),
                        32645
                    )
                ) as intersection_area
            FROM geology.geology g, input_geom i
            WHERE ST_Intersects(g.geom, i.geom)
            AND g."geology class" IS NOT NULL
            AND g."geology class" != 'No Data'
        )
        SELECT
            geology_class,
            (intersection_area / (SELECT area FROM total_area)) * 100 as percentage
        FROM geology_intersections
        WHERE intersection_area > 0
        ORDER BY percentage DESC

2026-02-07 14:34:32,550 INFO sqlalchemy.engine.Engine [cached since 127.2s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:34:32,557 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT
                ST_GeomFromText(%(wkt)s, 4326) as geom,
                ST_Centroid(ST_GeomFromText(%(wkt)s, 4326)) as centroid
        ),
        nearest_hq AS (
            SELECT
                dh."head quarter" as name,
                ST_Distance(
                    ST_Transform(i.centroid, 32645),
                    ST_Transform(dh.geom, 32645)
                ) / 1000.0 as distance_km,
                degrees(
                    ST_Azimuth(
                        i.centroid,
                        dh.geom
                    )
                ) as azimuth_degrees
            FROM admin."district Headquarter" dh, input_geom i
            WHERE dh."head quarter" IS NOT NULL
            ORDER BY ST_Distance(i.centroid, dh.geom)
            LIMIT 1
        )
        SELECT
            name,
            distance_km,
            azimuth_degrees,
            CASE
                WHEN azimuth_degrees >= 337.5 OR azimuth_degrees < 22.5 THEN 'North'
                WHEN azimuth_degrees >= 22.5 AND azimuth_degrees < 67.5 THEN 'Northeast'
                WHEN azimuth_degrees >= 67.5 AND azimuth_degrees < 112.5 THEN 'East'
                WHEN azimuth_degrees >= 112.5 AND azimuth_degrees < 157.5 THEN 'Southeast'
                WHEN azimuth_degrees >= 157.5 AND azimuth_degrees < 202.5 THEN 'South'
                WHEN azimuth_degrees >= 202.5 AND azimuth_degrees < 247.5 THEN 'Southwest'
                WHEN azimuth_degrees >= 247.5 AND azimuth_degrees < 292.5 THEN 'West'
                ELSE 'Northwest'
            END as direction
        FROM nearest_hq

2026-02-07 14:34:32,557 INFO sqlalchemy.engine.Engine [cached since 127.2s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
  Calling analyze_nearby_features...
  Calling PostgreSQL analyze_nearby_features function...
2026-02-07 14:34:32,560 INFO sqlalchemy.engine.Engine SAVEPOINT sa_savepoint_1
2026-02-07 14:34:32,561 INFO sqlalchemy.engine.Engine [no key 0.00063s] {}
2026-02-07 14:34:32,562 INFO sqlalchemy.engine.Engine
            SELECT analyze_nearby_features(%(wkt)s)

2026-02-07 14:34:32,563 INFO sqlalchemy.engine.Engine [cached since 127.2s ago] {'wkt': 'POLYGON((85.03717209456956 27.4452210961317,85.03726984000008 27.44632338700005,85.03776562100006 27.44879342200006,85.03804303525311 27.449300213087 ... (318 characters truncated) ... 874753,85.03841651313292 27.44540435536751,85.03790244868908 27.4453104160841,85.03747910038179 27.4452298955167,85.03717209456956 27.4452210961317))'}
2026-02-07 14:35:30,499 INFO sqlalchemy.engine.Engine RELEASE SAVEPOINT sa_savepoint_1
2026-02-07 14:35:30,500 INFO sqlalchemy.engine.Engine [no key 0.00051s] {}
  PostgreSQL function returned all 4 directions:
    features_north: Laijhadi: N(7) 0m, unclassified: NW(320) 19m, tr
    features_east: Nishankhoriya: E(78) 1270m, Kusumdanda: SE(119)
    features_south: Chaukltol: SW(214) 0m, River/Strem Flow Line: SW(
    features_west: residential: SW(242) 12m, Chaukitol Suspension Br
  analyze_nearby_features returned: ['features_north', 'features_east', 'features_south', 'features_west']
  Features: N=Laijhadi: N(7) 0m, unclassified: NW(320) 19m, track: N(7) 227m, E=Nishankhoriya: E(78) 1270m, Kusumdanda: SE(119) 1579m, Kusumtar: E(102) 2154m, S=Chaukltol: SW(214) 0m, River/Strem Flow Line: SW(215) 0m, service: SW(219) 132m, W=residential: SW(242) 12m, Chaukitol Suspension Bridge: W(292) 25m, Thakaldanda: W(260) 1615m
  After update, block_results has keys: ['wkt', 'extent', 'elevation_min_m', 'elevation_max_m', 'elevation_mean_m', 'slope_dominant_class', 'slope_percentages', 'aspect_dominant', 'aspect_percentages', 'canopy_mean_m', 'canopy_dominant_class', 'canopy_percentages', 'agb_mean_mg_ha', 'agb_total_mg', 'carbon_stock_mg', 'forest_health_dominant', 'forest_health_percentages', 'forest_type_dominant', 'forest_type_percentages', 'landcover_dominant', 'landcover_percentages', 'forest_loss_hectares', 'forest_loss_by_year', 'forest_gain_hectares', 'fire_loss_hectares', 'fire_loss_by_year', 'temperature_mean_c', 'temperature_min_c', 'precipitation_mean_mm', 'soil_texture', 'province', 'district', 'municipality', 'ward', 'watershed', 'major_river_basin', 'geology_percentages', 'access_info', 'features_north', 'features_east', 'features_south', 'features_west']
Block 4 analysis completed successfully
2026-02-07 14:35:30,502 INFO sqlalchemy.engine.Engine COMMIT
Block 4 transaction committed
Analyzing block 5/5: Chaturvedi
2026-02-07 14:35:30,504 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:35:30,505 INFO sqlalchemy.engine.Engine
            SELECT ST_AsText(ST_GeomFromGeoJSON(%(geojson)s)) as wkt

2026-02-07 14:35:30,505 INFO sqlalchemy.engine.Engine [cached since 185.8s ago] {'geojson': '{"type": "Polygon", "coordinates": [[[85.0404909366054, 27.442378263315423], [85.04028716100002, 27.44222456000004], [85.03950317800015, 27.441528857 ... (412 characters truncated) ... 6834342, 27.444607493047496], [85.0383621968111, 27.44375104205515], [85.03995697256148, 27.4427573593862], [85.0404909366054, 27.442378263315423]]]}'}
2026-02-07 14:35:30,507 INFO sqlalchemy.engine.Engine
        SELECT
            ST_YMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as north,
            ST_YMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as south,
            ST_XMax(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as east,
            ST_XMin(ST_Envelope(ST_GeomFromText(%(wkt)s, 4326))) as west

2026-02-07 14:35:30,508 INFO sqlalchemy.engine.Engine [cached since 185.8s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,509 INFO sqlalchemy.engine.Engine
            WITH clipped_raster AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.dem
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ),
            pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as elevation
                FROM clipped_raster
            )
            SELECT
                MIN(elevation) as elevation_min,
                MAX(elevation) as elevation_max,
                AVG(elevation) as elevation_mean
            FROM pixel_values
            WHERE elevation > -32000  -- Exclude NoData values (-32768)
              AND elevation >= 0       -- Nepal minimum elevation
              AND elevation <= 9000    -- Nepal maximum elevation

2026-02-07 14:35:30,510 INFO sqlalchemy.engine.Engine [cached since 185.8s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,514 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as slope_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.slope
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value > 0
              AND (pvc).value <= 4
            GROUP BY slope_code

2026-02-07 14:35:30,514 INFO sqlalchemy.engine.Engine [cached since 185.6s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,516 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as aspect_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.aspect
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 0 AND 8
            GROUP BY aspect_code

2026-02-07 14:35:30,517 INFO sqlalchemy.engine.Engine [cached since 185.6s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,519 INFO sqlalchemy.engine.Engine
            WITH boundary AS (
                SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
            ),
            all_pixels AS (
                SELECT
                    (pix).val as height,
                    (pix).geom as pixel_center
                FROM (
                    SELECT ST_PixelAsPolygons(rast) as pix
                    FROM rasters.canopy_height, boundary
                    WHERE ST_Intersects(rast, geom)
                ) as subq
            )
            SELECT
                CASE
                    WHEN height = 0 THEN 'non_forest'
                    WHEN height > 0 AND height <= 5 THEN 'bush_regenerated'
                    WHEN height > 5 AND height <= 15 THEN 'pole_trees'
                    WHEN height > 15 THEN 'high_forest'
                END as canopy_class,
                COUNT(*) as pixel_count,
                AVG(height) as avg_height
            FROM all_pixels, boundary
            WHERE ST_Contains(boundary.geom, ST_Centroid(pixel_center))
              AND height IS NOT NULL
              AND height >= 0
              AND height <= 50
            GROUP BY canopy_class

2026-02-07 14:35:30,520 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,580 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as agb_mean,
                (stats).sum as agb_total
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, 1, ST_GeomFromText(%(wkt)s, 4326)),
                    1,  -- band 1
                    true  -- exclude nodata
                ) as stats
                FROM rasters.agb_2022_nepal
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ) as subquery

2026-02-07 14:35:30,581 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,584 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as health_class,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_forest_health
                WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 5
            GROUP BY health_class

2026-02-07 14:35:30,584 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,589 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as forest_type_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_type WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 26
            GROUP BY forest_type_code ORDER BY pixel_count DESC

2026-02-07 14:35:30,589 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,592 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as landcover_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.esa_world_cover WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL
            GROUP BY landcover_code ORDER BY pixel_count DESC

2026-02-07 14:35:30,592 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,608 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as loss_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_lossyear WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY loss_year ORDER BY loss_year

2026-02-07 14:35:30,609 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,612 INFO sqlalchemy.engine.Engine
            SELECT SUM((pvc).count) as gain_pixels
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.nepal_gain WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value = 1

2026-02-07 14:35:30,613 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,615 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as fire_year, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.forest_loss_fire WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 23
            GROUP BY fire_year ORDER BY fire_year

2026-02-07 14:35:30,615 INFO sqlalchemy.engine.Engine [cached since 185.5s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,618 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_mean_temperature WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_mean FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:35:30,619 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,622 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.min_temp_coldest_month WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as temp FROM clipped
            )
            SELECT AVG(temp) as temp_min FROM pixel_values WHERE temp IS NOT NULL AND temp > -100 AND temp < 100

2026-02-07 14:35:30,622 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,625 INFO sqlalchemy.engine.Engine
            WITH clipped AS (
                SELECT ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326)) as rast
                FROM rasters.annual_precipitation WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
                LIMIT 1
            ), pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as precip FROM clipped
            )
            SELECT AVG(precip) as precip_mean FROM pixel_values WHERE precip IS NOT NULL AND precip >= 0

2026-02-07 14:35:30,625 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,629 INFO sqlalchemy.engine.Engine
            SELECT (pvc).value as texture_code, SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, ST_GeomFromText(%(wkt)s, 4326))) as pvc
                FROM rasters.soilgrids_isric WHERE ST_Intersects(rast, ST_GeomFromText(%(wkt)s, 4326))
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 12
            GROUP BY texture_code ORDER BY pixel_count DESC LIMIT 1

2026-02-07 14:35:30,630 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,634 INFO sqlalchemy.engine.Engine
        SELECT p.province
        FROM admin.province p
        WHERE ST_Intersects(
            p.shape,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:35:30,634 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,638 INFO sqlalchemy.engine.Engine
        SELECT m.district, m.gapa_napa as municipality
        FROM admin.municipality m
        WHERE ST_Intersects(
            m.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:35:30,638 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,640 INFO sqlalchemy.engine.Engine
        SELECT w.ward
        FROM admin.ward w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:35:30,640 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,642 INFO sqlalchemy.engine.Engine
        SELECT w."watershed name" as watershed_name, w."major river basin" as major_river_basin
        FROM admin."watershed_Nepal" w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:35:30,643 INFO sqlalchemy.engine.Engine [cached since 185.4s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,644 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
        ),
        total_area AS (
            SELECT ST_Area(ST_Transform(geom, 32645)) as area
            FROM input_geom
        ),
        geology_intersections AS (
            SELECT
                g."geology class" as geology_class,
                ST_Area(
                    ST_Transform(
                        ST_Intersection(g.geom, i.geom),
                        32645
                    )
                ) as intersection_area
            FROM geology.geology g, input_geom i
            WHERE ST_Intersects(g.geom, i.geom)
            AND g."geology class" IS NOT NULL
            AND g."geology class" != 'No Data'
        )
        SELECT
            geology_class,
            (intersection_area / (SELECT area FROM total_area)) * 100 as percentage
        FROM geology_intersections
        WHERE intersection_area > 0
        ORDER BY percentage DESC

2026-02-07 14:35:30,645 INFO sqlalchemy.engine.Engine [cached since 185.3s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:35:30,650 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT
                ST_GeomFromText(%(wkt)s, 4326) as geom,
                ST_Centroid(ST_GeomFromText(%(wkt)s, 4326)) as centroid
        ),
        nearest_hq AS (
            SELECT
                dh."head quarter" as name,
                ST_Distance(
                    ST_Transform(i.centroid, 32645),
                    ST_Transform(dh.geom, 32645)
                ) / 1000.0 as distance_km,
                degrees(
                    ST_Azimuth(
                        i.centroid,
                        dh.geom
                    )
                ) as azimuth_degrees
            FROM admin."district Headquarter" dh, input_geom i
            WHERE dh."head quarter" IS NOT NULL
            ORDER BY ST_Distance(i.centroid, dh.geom)
            LIMIT 1
        )
        SELECT
            name,
            distance_km,
            azimuth_degrees,
            CASE
                WHEN azimuth_degrees >= 337.5 OR azimuth_degrees < 22.5 THEN 'North'
                WHEN azimuth_degrees >= 22.5 AND azimuth_degrees < 67.5 THEN 'Northeast'
                WHEN azimuth_degrees >= 67.5 AND azimuth_degrees < 112.5 THEN 'East'
                WHEN azimuth_degrees >= 112.5 AND azimuth_degrees < 157.5 THEN 'Southeast'
                WHEN azimuth_degrees >= 157.5 AND azimuth_degrees < 202.5 THEN 'South'
                WHEN azimuth_degrees >= 202.5 AND azimuth_degrees < 247.5 THEN 'Southwest'
                WHEN azimuth_degrees >= 247.5 AND azimuth_degrees < 292.5 THEN 'West'
                ELSE 'Northwest'
            END as direction
        FROM nearest_hq

2026-02-07 14:35:30,650 INFO sqlalchemy.engine.Engine [cached since 185.3s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
  Calling analyze_nearby_features...
  Calling PostgreSQL analyze_nearby_features function...
2026-02-07 14:35:30,653 INFO sqlalchemy.engine.Engine SAVEPOINT sa_savepoint_1
2026-02-07 14:35:30,653 INFO sqlalchemy.engine.Engine [no key 0.00040s] {}
2026-02-07 14:35:30,654 INFO sqlalchemy.engine.Engine
            SELECT analyze_nearby_features(%(wkt)s)

2026-02-07 14:35:30,654 INFO sqlalchemy.engine.Engine [cached since 185.3s ago] {'wkt': 'POLYGON((85.0404909366054 27.442378263315423,85.04028716100002 27.44222456000004,85.03950317800015 27.44152885700003,85.03874935400007 27.44075287500 ... (316 characters truncated) ... 11968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423))'}
2026-02-07 14:36:41,314 INFO sqlalchemy.engine.Engine RELEASE SAVEPOINT sa_savepoint_1
2026-02-07 14:36:41,314 INFO sqlalchemy.engine.Engine [no key 0.00066s] {}
  PostgreSQL function returned all 4 directions:
    features_north: Chaukltol: N(348) 0m, River/Strem Flow Line: N(35
    features_east: track: E(100) 0m,  : E(107) 449m, Kusumdanda: E(
    features_south:     : S(197) 224m, hot
    features_west: residential: NW(305) 0m, Laijhadi: NW(311) 743m,
  analyze_nearby_features returned: ['features_north', 'features_east', 'features_south', 'features_west']
  Features: N=Chaukltol: N(348) 0m, River/Strem Flow Line: N(356) 0m, service: NW(336) 72m, E=track: E(100) 0m,  : E(107) 449m, Kusumdanda: E(100) 1386m, S=    : S(197) 224m, hotel: SW(204) 264m, bus_station: SW(206) 318m, W=residential: NW(305) 0m, Laijhadi: NW(311) 743m, Shri Amar Ma V: SW(233) 1089m
  After update, block_results has keys: ['wkt', 'extent', 'elevation_min_m', 'elevation_max_m', 'elevation_mean_m', 'slope_dominant_class', 'slope_percentages', 'aspect_dominant', 'aspect_percentages', 'canopy_mean_m', 'canopy_dominant_class', 'canopy_percentages', 'agb_mean_mg_ha', 'agb_total_mg', 'carbon_stock_mg', 'forest_health_dominant', 'forest_health_percentages', 'forest_type_dominant', 'forest_type_percentages', 'landcover_dominant', 'landcover_percentages', 'forest_loss_hectares', 'forest_loss_by_year', 'forest_gain_hectares', 'fire_loss_hectares', 'fire_loss_by_year', 'temperature_mean_c', 'temperature_min_c', 'precipitation_mean_mm', 'soil_texture', 'province', 'district', 'municipality', 'ward', 'watershed', 'major_river_basin', 'geology_percentages', 'access_info', 'features_north', 'features_east', 'features_south', 'features_west']
Block 5 analysis completed successfully
2026-02-07 14:36:41,318 INFO sqlalchemy.engine.Engine COMMIT
Block 5 transaction committed
Committing block analysis results...
Block analysis committed successfully
Starting whole-forest analysis...
2026-02-07 14:36:41,327 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:36:41,329 INFO sqlalchemy.engine.Engine
        SELECT
            ST_X(ST_Centroid(boundary_geom)) as lon,
            ST_Y(ST_Centroid(boundary_geom)) as lat
        FROM public.calculations
        WHERE id = %(calc_id)s

2026-02-07 14:36:41,331 INFO sqlalchemy.engine.Engine [generated in 0.00208s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,345 INFO sqlalchemy.engine.Engine
        SELECT
            ST_Area(ST_Transform(boundary_geom, 32645)) as area_sqm,
            ST_Area(ST_Transform(boundary_geom, 32645)) / 10000.0 as area_hectares
        FROM public.calculations
        WHERE id = %(calc_id)s

2026-02-07 14:36:41,347 INFO sqlalchemy.engine.Engine [generated in 0.00176s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,354 INFO sqlalchemy.engine.Engine
        SELECT
            ST_YMax(ST_Envelope(boundary_geom)) as north,
            ST_YMin(ST_Envelope(boundary_geom)) as south,
            ST_XMax(ST_Envelope(boundary_geom)) as east,
            ST_XMin(ST_Envelope(boundary_geom)) as west
        FROM calculations WHERE id = %(calc_id)s

2026-02-07 14:36:41,356 INFO sqlalchemy.engine.Engine [generated in 0.00176s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,363 INFO sqlalchemy.engine.Engine
            WITH clipped_raster AS (
                SELECT ST_Clip(rast, boundary_geom) as rast
                FROM rasters.dem, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
                LIMIT 1
            ),
            pixel_values AS (
                SELECT (ST_PixelAsPolygons(rast)).val as elevation
                FROM clipped_raster
            )
            SELECT
                MIN(elevation) as elevation_min,
                MAX(elevation) as elevation_max,
                AVG(elevation) as elevation_mean
            FROM pixel_values
            WHERE elevation > -32000  -- Exclude NoData values (-32768)
              AND elevation >= 0       -- Nepal minimum elevation
              AND elevation <= 9000    -- Nepal maximum elevation

2026-02-07 14:36:41,364 INFO sqlalchemy.engine.Engine [generated in 0.00173s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,396 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as slope_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.slope, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value > 0
              AND (pvc).value <= 4
            GROUP BY slope_code

2026-02-07 14:36:41,398 INFO sqlalchemy.engine.Engine [generated in 0.00179s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,430 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as aspect_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.aspect, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 0 AND 8
            GROUP BY aspect_code

2026-02-07 14:36:41,431 INFO sqlalchemy.engine.Engine [generated in 0.00171s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,457 INFO sqlalchemy.engine.Engine
            SELECT
                CASE
                    WHEN (pvc).value = 0 THEN 'non_forest'
                    WHEN (pvc).value > 0 AND (pvc).value <= 5 THEN 'bush_regenerated'
                    WHEN (pvc).value > 5 AND (pvc).value <= 15 THEN 'pole_trees'
                    WHEN (pvc).value > 15 THEN 'high_forest'
                END as canopy_class,
                SUM((pvc).count) as pixel_count,
                AVG((pvc).value) as avg_height
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.canopy_height, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL
              AND (pvc).value >= 0
              AND (pvc).value <= 50
            GROUP BY canopy_class

2026-02-07 14:36:41,458 INFO sqlalchemy.engine.Engine [generated in 0.00075s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,469 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as agb_mean,
                (stats).sum as agb_total
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, 1, boundary_geom)
                ) as stats
                FROM rasters.agb_2022_nepal, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
                LIMIT 1
            ) as subquery

2026-02-07 14:36:41,470 INFO sqlalchemy.engine.Engine [generated in 0.00066s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,474 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as health_class,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.nepal_forest_health, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 5
            GROUP BY health_class

2026-02-07 14:36:41,475 INFO sqlalchemy.engine.Engine [generated in 0.00061s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,483 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as forest_type_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.forest_type, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value BETWEEN 1 AND 26
            GROUP BY forest_type_code
            ORDER BY pixel_count DESC

2026-02-07 14:36:41,484 INFO sqlalchemy.engine.Engine [generated in 0.00059s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,491 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as landcover_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.esa_world_cover, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL
            GROUP BY landcover_code
            ORDER BY pixel_count DESC

2026-02-07 14:36:41,491 INFO sqlalchemy.engine.Engine [generated in 0.00051s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,498 INFO sqlalchemy.engine.Engine
            SELECT
                (amt_stats).mean * 0.1 as temp_mean_c,
                (mint_stats).mean * 0.1 as temp_min_c
            FROM (
                SELECT
                    ST_SummaryStats(ST_Clip(amt.rast, calc.boundary_geom), 1, true) as amt_stats,
                    ST_SummaryStats(ST_Clip(mint.rast, calc.boundary_geom), 1, true) as mint_stats
                FROM rasters.annual_mean_temperature amt,
                     rasters.min_temp_coldest_month mint,
                     public.calculations calc
                WHERE calc.id = %(calc_id)s
                  AND ST_Intersects(amt.rast, calc.boundary_geom)
                  AND ST_Intersects(mint.rast, calc.boundary_geom)
                LIMIT 1
            ) as subquery

2026-02-07 14:36:41,498 INFO sqlalchemy.engine.Engine [generated in 0.00044s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,503 INFO sqlalchemy.engine.Engine
            SELECT
                (stats).mean as precip_mean_mm
            FROM (
                SELECT ST_SummaryStats(
                    ST_Clip(rast, boundary_geom),
                    1,
                    true
                ) as stats
                FROM rasters.annual_precipitation, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
                LIMIT 1
            ) as subquery

2026-02-07 14:36:41,504 INFO sqlalchemy.engine.Engine [generated in 0.00047s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,507 INFO sqlalchemy.engine.Engine
            SELECT ST_Area(ST_Transform(boundary_geom, 32645)) / 10000.0 as area_hectares
            FROM public.calculations
            WHERE id = %(calc_id)s

2026-02-07 14:36:41,507 INFO sqlalchemy.engine.Engine [generated in 0.00048s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,509 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as loss_year_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.nepal_lossyear, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value > 0
            GROUP BY loss_year_code
            ORDER BY loss_year_code

2026-02-07 14:36:41,509 INFO sqlalchemy.engine.Engine [generated in 0.00047s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,513 INFO sqlalchemy.engine.Engine
            SELECT
                SUM((pvc).count) as gain_pixels
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.nepal_gain, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value = 1

2026-02-07 14:36:41,513 INFO sqlalchemy.engine.Engine [generated in 0.00044s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,516 INFO sqlalchemy.engine.Engine
            SELECT
                (pvc).value as fire_year_code,
                SUM((pvc).count) as pixel_count
            FROM (
                SELECT ST_ValueCount(ST_Clip(rast, boundary_geom)) as pvc
                FROM rasters.forest_loss_fire, public.calculations
                WHERE calculations.id = %(calc_id)s
                  AND ST_Intersects(rast, boundary_geom)
            ) as subquery
            WHERE (pvc).value IS NOT NULL AND (pvc).value > 0
            GROUP BY fire_year_code

2026-02-07 14:36:41,517 INFO sqlalchemy.engine.Engine [generated in 0.00057s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,526 INFO sqlalchemy.engine.Engine
        SELECT ST_AsText(boundary_geom) as wkt
        FROM public.calculations
        WHERE id = %(calc_id)s

2026-02-07 14:36:41,526 INFO sqlalchemy.engine.Engine [generated in 0.00066s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:36:41,529 INFO sqlalchemy.engine.Engine
        SELECT p.province
        FROM admin.province p
        WHERE ST_Intersects(
            p.shape,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:36:41,529 INFO sqlalchemy.engine.Engine [cached since 256.3s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
2026-02-07 14:36:41,535 INFO sqlalchemy.engine.Engine
        SELECT m.district, m.gapa_napa as municipality
        FROM admin.municipality m
        WHERE ST_Intersects(
            m.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:36:41,536 INFO sqlalchemy.engine.Engine [cached since 256.3s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
2026-02-07 14:36:41,542 INFO sqlalchemy.engine.Engine
        SELECT w.ward
        FROM admin.ward w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:36:41,542 INFO sqlalchemy.engine.Engine [cached since 256.3s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
2026-02-07 14:36:41,545 INFO sqlalchemy.engine.Engine
        SELECT w."watershed name" as watershed_name, w."major river basin" as major_river_basin
        FROM admin."watershed_Nepal" w
        WHERE ST_Intersects(
            w.geom,
            ST_Centroid(ST_GeomFromText(%(wkt)s, 4326))
        )
        LIMIT 1

2026-02-07 14:36:41,546 INFO sqlalchemy.engine.Engine [cached since 256.3s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
2026-02-07 14:36:41,548 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT ST_GeomFromText(%(wkt)s, 4326) as geom
        ),
        total_area AS (
            SELECT ST_Area(ST_Transform(geom, 32645)) as area
            FROM input_geom
        ),
        geology_intersections AS (
            SELECT
                g."geology class" as geology_class,
                ST_Area(
                    ST_Transform(
                        ST_Intersection(g.geom, i.geom),
                        32645
                    )
                ) as intersection_area
            FROM geology.geology g, input_geom i
            WHERE ST_Intersects(g.geom, i.geom)
            AND g."geology class" IS NOT NULL
            AND g."geology class" != 'No Data'
        )
        SELECT
            geology_class,
            (intersection_area / (SELECT area FROM total_area)) * 100 as percentage
        FROM geology_intersections
        WHERE intersection_area > 0
        ORDER BY percentage DESC

2026-02-07 14:36:41,549 INFO sqlalchemy.engine.Engine [cached since 256.2s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
2026-02-07 14:36:41,564 INFO sqlalchemy.engine.Engine
        WITH input_geom AS (
            SELECT
                ST_GeomFromText(%(wkt)s, 4326) as geom,
                ST_Centroid(ST_GeomFromText(%(wkt)s, 4326)) as centroid
        ),
        nearest_hq AS (
            SELECT
                dh."head quarter" as name,
                ST_Distance(
                    ST_Transform(i.centroid, 32645),
                    ST_Transform(dh.geom, 32645)
                ) / 1000.0 as distance_km,
                degrees(
                    ST_Azimuth(
                        i.centroid,
                        dh.geom
                    )
                ) as azimuth_degrees
            FROM admin."district Headquarter" dh, input_geom i
            WHERE dh."head quarter" IS NOT NULL
            ORDER BY ST_Distance(i.centroid, dh.geom)
            LIMIT 1
        )
        SELECT
            name,
            distance_km,
            azimuth_degrees,
            CASE
                WHEN azimuth_degrees >= 337.5 OR azimuth_degrees < 22.5 THEN 'North'
                WHEN azimuth_degrees >= 22.5 AND azimuth_degrees < 67.5 THEN 'Northeast'
                WHEN azimuth_degrees >= 67.5 AND azimuth_degrees < 112.5 THEN 'East'
                WHEN azimuth_degrees >= 112.5 AND azimuth_degrees < 157.5 THEN 'Southeast'
                WHEN azimuth_degrees >= 157.5 AND azimuth_degrees < 202.5 THEN 'South'
                WHEN azimuth_degrees >= 202.5 AND azimuth_degrees < 247.5 THEN 'Southwest'
                WHEN azimuth_degrees >= 247.5 AND azimuth_degrees < 292.5 THEN 'West'
                ELSE 'Northwest'
            END as direction
        FROM nearest_hq

2026-02-07 14:36:41,564 INFO sqlalchemy.engine.Engine [cached since 256.2s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
  Calling PostgreSQL analyze_nearby_features function...
2026-02-07 14:36:41,569 INFO sqlalchemy.engine.Engine SAVEPOINT sa_savepoint_1
2026-02-07 14:36:41,570 INFO sqlalchemy.engine.Engine [no key 0.00095s] {}
2026-02-07 14:36:41,571 INFO sqlalchemy.engine.Engine
            SELECT analyze_nearby_features(%(wkt)s)

2026-02-07 14:36:41,572 INFO sqlalchemy.engine.Engine [cached since 256.2s ago] {'wkt': 'MULTIPOLYGON(((85.0400647996589 27.452510086609063,85.04009173000007 27.45254918800002,85.04104511200006 27.45420717300007,85.04199853799997 27.45593 ... (4048 characters truncated) ... 1968,85.0371176834342 27.444607493047496,85.0383621968111 27.44375104205515,85.03995697256148 27.4427573593862,85.0404909366054 27.442378263315423)))'}
2026-02-07 14:38:37,348 INFO sqlalchemy.engine.Engine RELEASE SAVEPOINT sa_savepoint_1
2026-02-07 14:38:37,348 INFO sqlalchemy.engine.Engine [no key 0.00045s] {}
  PostgreSQL function returned all 4 directions:
    features_north: path: NE(30) 0m, residential: N(2) 0m, Suparitar
    features_east: unclassified: E(72) 0m, track: SE(125) 0m, River
    features_south: Chaukltol: SW(203) 0m, Kusumdanda: SE(145) 0m,
    features_west: Shri Barahi Ni Ma V: NW(305) 424m, Laijhadi: W(27
Committing final analysis results...
2026-02-07 14:38:37,350 INFO sqlalchemy.engine.Engine COMMIT
Analysis transaction committed successfully
Analysis completed with 52 keys
Executing UPDATE with 23394 bytes of data
2026-02-07 14:38:37,359 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:37,360 INFO sqlalchemy.engine.Engine
            UPDATE public.calculations
            SET
                result_data = result_data || CAST(%(analysis_data)s AS jsonb),
                processing_time_seconds = %(processing_time)s,
                status = %(status)s,
                completed_at = NOW()
            WHERE id = %(calc_id)s

2026-02-07 14:38:37,361 INFO sqlalchemy.engine.Engine [generated in 0.00055s] {'analysis_data': '{"blocks": [{"area_sqm": 416608.63738251413, "centroid": {"lat": 27.45064124863217, "lon": 85.04435488673336}, "geometry": {"type": "Polygon", "coord ... (23201 characters truncated) ... rahi Ni Ma V: NW(305\\u00b0) 424m, Laijhadi: W(271\\u00b0) 694m, Maintar: NW(313\\u00b0) 850m", "province": null, "municipality": null, "ward": null}', 'processing_time': 372, 'status': 'COMPLETED', 'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
UPDATE affected 1 rows
2026-02-07 14:38:37,406 INFO sqlalchemy.engine.Engine COMMIT
Commit successful
Auto-generating fieldbook with 50m interpolation for calculation 38bf84f9-d0e9-4f37-b08a-8d86ada4b89f
2026-02-07 14:38:37,411 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:37,411 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:37,412 INFO sqlalchemy.engine.Engine [cached since 517.4s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
2026-02-07 14:38:37,418 INFO sqlalchemy.engine.Engine DELETE FROM public.fieldbook WHERE public.fieldbook.calculation_id = %(calculation_id_1)s::UUID
2026-02-07 14:38:37,419 INFO sqlalchemy.engine.Engine [generated in 0.00070s] {'calculation_id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f')}
2026-02-07 14:38:37,433 INFO sqlalchemy.engine.Engine COMMIT
2026-02-07 14:38:37,435 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:37,436 INFO sqlalchemy.engine.Engine
        SELECT
            ST_AsText(boundary_geom) as wkt,
            ST_GeometryType(boundary_geom) as geom_type,
            ST_NumGeometries(boundary_geom) as num_blocks
        FROM public.calculations
        WHERE id = %(calc_id)s

2026-02-07 14:38:37,436 INFO sqlalchemy.engine.Engine [generated in 0.00054s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:38:37,442 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(pk_1)s::UUID
2026-02-07 14:38:37,443 INFO sqlalchemy.engine.Engine [generated in 0.00062s] {'pk_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f')}
2026-02-07 14:38:37,474 INFO sqlalchemy.engine.Engine INSERT INTO public.fieldbook (id, calculation_id, point_number, point_type, block_number, block_name, longitude, latitude, utm_zone, azimuth_to_next, distance_to_next, is_verified) VALUES (%(id__0)s::UUID, %(calculation_id__0)s::UUID, %(point_number_ ... 79051 characters truncated ... 294)s, %(utm_zone__294)s, %(azimuth_to_next__294)s, %(distance_to_next__294)s, %(is_verified__294)s)
2026-02-07 14:38:37,474 INFO sqlalchemy.engine.Engine [generated in 0.00210s (insertmanyvalues) 1/1 (unordered)] {'is_verified__0': False, 'point_number__0': 1, 'id__0': UUID('3a9a1ed6-ce4c-494f-9d3b-87b986700d1d'), 'point_type__0': 'vertex', 'longitude__0': Decimal('85.0400647996589'), 'distance_to_next__0': Decimal('5.1'), 'azimuth_to_next__0': Decimal('31.43'), 'block_number__0': 1, 'latitude__0': Decimal('27.452510086609063'), 'block_name__0': 'Eklal', 'calculation_id__0': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__0': 45, 'is_verified__1': False, 'point_number__1': 2, 'id__1': UUID('1ff762c4-f4a2-4690-8070-9ce2abdc3549'), 'point_type__1': 'vertex', 'longitude__1': Decimal('85.04009173000007'), 'distance_to_next__1': Decimal('50.0'), 'azimuth_to_next__1': Decimal('27.03'), 'block_number__1': 1, 'latitude__1': Decimal('27.45254918800002'), 'block_name__1': 'Eklal', 'calculation_id__1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__1': 45, 'is_verified__2': False, 'point_number__2': 3, 'id__2': UUID('f9d2bb8b-eee2-4643-81d1-2ddca8eac6c4'), 'point_type__2': 'interpolated', 'longitude__2': Decimal('85.0403220462608'), 'distance_to_next__2': Decimal('50.0'), 'azimuth_to_next__2': Decimal('27.03'), 'block_number__2': 1, 'latitude__2': Decimal('27.452949726112102'), 'block_name__2': 'Eklal', 'calculation_id__2': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__2': 45, 'is_verified__3': False, 'point_number__3': 4, 'id__3': UUID('6414d9ad-0ad6-43ca-907f-ad2170f55069'), 'point_type__3': 'interpolated', 'longitude__3': Decimal('85.04055236419447'), 'distance_to_next__3': Decimal('50.0'), 'azimuth_to_next__3': Decimal('27.03'), 'block_number__3': 1, 'latitude__3': Decimal('27.45335026384541'), 'block_name__3': 'Eklal', 'calculation_id__3': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__3': 45, 'is_verified__4': False, 'point_number__4': 5 ... 3440 parameters truncated ... 'calculation_id__290': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__290': 45, 'is_verified__291': False, 'point_number__291': 292, 'id__291': UUID('d83c19ae-5d4c-45a7-a5b9-b98c8dfae973'), 'point_type__291': 'interpolated', 'longitude__291': Decimal('85.0391915600874'), 'distance_to_next__291': Decimal('50.0'), 'azimuth_to_next__291': Decimal('125.07'), 'block_number__291': 5, 'latitude__291': Decimal('27.443234281790925'), 'block_name__291': 'Chaturvedi', 'calculation_id__291': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__291': 45, 'is_verified__292': False, 'point_number__292': 293, 'id__292': UUID('39fb0393-8c1e-4130-9d67-025e13727487'), 'point_type__292': 'interpolated', 'longitude__292': Decimal('85.03960623881215'), 'distance_to_next__292': Decimal('42.29'), 'azimuth_to_next__292': Decimal('125.07'), 'block_number__292': 5, 'latitude__292': Decimal('27.442975899817505'), 'block_name__292': 'Chaturvedi', 'calculation_id__292': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__292': 45, 'is_verified__293': False, 'point_number__293': 294, 'id__293': UUID('5db995dc-3e00-415c-94fc-d00777dede51'), 'point_type__293': 'vertex', 'longitude__293': Decimal('85.03995697256148'), 'distance_to_next__293': Decimal('50.0'), 'azimuth_to_next__293': Decimal('128.66'), 'block_number__293': 5, 'latitude__293': Decimal('27.4427573593862'), 'block_name__293': 'Chaturvedi', 'calculation_id__293': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__293': 45, 'is_verified__294': False, 'point_number__294': 295, 'id__294': UUID('a6584e5b-b7a8-4d51-baec-64a2e07ae757'), 'point_type__294': 'interpolated', 'longitude__294': Decimal('85.04035261906353'), 'distance_to_next__294': Decimal('1116.05'), 'azimuth_to_next__294': Decimal('358.54'), 'block_number__294': 5, 'latitude__294': Decimal('27.44247646444906'), 'block_name__294': 'Chaturvedi', 'calculation_id__294': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'utm_zone__294': 45}
2026-02-07 14:38:37,564 INFO sqlalchemy.engine.Engine COMMIT
2026-02-07 14:38:37,567 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:37,568 INFO sqlalchemy.engine.Engine
        UPDATE public.fieldbook
        SET
            point_geometry = ST_SetSRID(ST_MakePoint(longitude, latitude), 4326),
            easting_utm = CASE
                WHEN longitude < 84.0 THEN ST_X(ST_Transform(ST_SetSRID(ST_MakePoint(longitude, latitude), 4326), 32644))
                ELSE ST_X(ST_Transform(ST_SetSRID(ST_MakePoint(longitude, latitude), 4326), 32645))
            END,
            northing_utm = CASE
                WHEN longitude < 84.0 THEN ST_Y(ST_Transform(ST_SetSRID(ST_MakePoint(longitude, latitude), 4326), 32644))
                ELSE ST_Y(ST_Transform(ST_SetSRID(ST_MakePoint(longitude, latitude), 4326), 32645))
            END,
            utm_zone = CASE
                WHEN longitude < 84.0 THEN 44
                ELSE 45
            END
        WHERE calculation_id = %(calc_id)s

2026-02-07 14:38:37,569 INFO sqlalchemy.engine.Engine [generated in 0.00068s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:38:37,688 INFO sqlalchemy.engine.Engine
        UPDATE public.fieldbook fb
        SET elevation = (
            SELECT ST_Value(rast, fb.point_geometry)
            FROM rasters.dem
            WHERE ST_Intersects(rast, fb.point_geometry)
            LIMIT 1
        )
        WHERE fb.calculation_id = %(calc_id)s
        AND fb.point_geometry IS NOT NULL

2026-02-07 14:38:37,688 INFO sqlalchemy.engine.Engine [generated in 0.00047s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
2026-02-07 14:38:37,823 INFO sqlalchemy.engine.Engine COMMIT
2026-02-07 14:38:37,831 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:37,834 INFO sqlalchemy.engine.Engine
        SELECT
            MIN(elevation) as min_elevation,
            MAX(elevation) as max_elevation,
            AVG(elevation) as avg_elevation
        FROM public.fieldbook
        WHERE calculation_id = %(calc_id)s
        AND elevation IS NOT NULL

2026-02-07 14:38:37,836 INFO sqlalchemy.engine.Engine [generated in 0.00228s] {'calc_id': '38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'}
Warning: Fieldbook auto-generation failed: 'FieldbookGenerateResponse' object is not subscriptable
Auto-generating sampling design for calculation 38bf84f9-d0e9-4f37-b08a-8d86ada4b89f
Warning: Sampling auto-generation failed: create_sampling_design() got an unexpected keyword argument 'method'
2026-02-07 14:38:37,864 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:37,866 INFO sqlalchemy.engine.Engine [cached since 517.8s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
Refreshed calculation, result_data has 54 keys
2026-02-07 14:38:37,882 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:37,884 INFO sqlalchemy.engine.Engine [cached since 517.8s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
2026-02-07 14:38:37,907 INFO sqlalchemy.engine.Engine SELECT ST_AsGeoJSON(public.calculations.boundary_geom) AS geojson
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:37,909 INFO sqlalchemy.engine.Engine [generated in 0.00176s] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
INFO:     127.0.0.1:59344 - "POST /api/forests/upload HTTP/1.1" 201 Created
2026-02-07 14:38:37,950 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59344 - "OPTIONS /api/forests/calculations/38bf84f9-d0e9-4f37-b08a-8d86ada4b89f HTTP/1.1" 200 OK
INFO:     127.0.0.1:59344 - "OPTIONS /api/forests/calculations/38bf84f9-d0e9-4f37-b08a-8d86ada4b89f HTTP/1.1" 200 OK
2026-02-07 14:38:38,231 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:38,234 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:38,236 INFO sqlalchemy.engine.Engine [cached since 537.6s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:38:38,251 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:38,252 INFO sqlalchemy.engine.Engine [cached since 518.2s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
2026-02-07 14:38:38,280 INFO sqlalchemy.engine.Engine SELECT ST_AsGeoJSON(public.calculations.boundary_geom) AS geojson
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:38,282 INFO sqlalchemy.engine.Engine [cached since 0.3745s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
INFO:     127.0.0.1:59344 - "GET /api/forests/calculations/38bf84f9-d0e9-4f37-b08a-8d86ada4b89f HTTP/1.1" 200 OK
2026-02-07 14:38:38,316 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-07 14:38:38,345 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-07 14:38:38,349 INFO sqlalchemy.engine.Engine SELECT public.users.id AS public_users_id, public.users.email AS public_users_email, public.users.hashed_password AS public_users_hashed_password, public.users.full_name AS public_users_full_name, public.users.phone AS public_users_phone, public.users.role AS public_users_role, public.users.status AS public_users_status, public.users.organization_id AS public_users_organization_id, public.users.created_at AS public_users_created_at, public.users.last_login AS public_users_last_login
FROM public.users
WHERE public.users.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:38,351 INFO sqlalchemy.engine.Engine [cached since 537.7s ago] {'id_1': '68646d11-ba45-4a39-8ab5-951c90786f2a', 'param_1': 1}
2026-02-07 14:38:38,365 INFO sqlalchemy.engine.Engine SELECT public.calculations.id AS public_calculations_id, public.calculations.user_id AS public_calculations_user_id, public.calculations.application_id AS public_calculations_application_id, public.calculations.uploaded_filename AS public_calculations_uploaded_filename, ST_AsEWKB(public.calculations.boundary_geom) AS public_calculations_boundary_geom, public.calculations.forest_name AS public_calculations_forest_name, public.calculations.block_name AS public_calculations_block_name, public.calculations.result_data AS public_calculations_result_data, public.calculations.status AS public_calculations_status, public.calculations.processing_time_seconds AS public_calculations_processing_time_seconds, public.calculations.error_message AS public_calculations_error_message, public.calculations.created_at AS public_calculations_created_at, public.calculations.completed_at AS public_calculations_completed_at
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:38,367 INFO sqlalchemy.engine.Engine [cached since 518.3s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
2026-02-07 14:38:38,384 INFO sqlalchemy.engine.Engine SELECT ST_AsGeoJSON(public.calculations.boundary_geom) AS geojson
FROM public.calculations
WHERE public.calculations.id = %(id_1)s::UUID
 LIMIT %(param_1)s
2026-02-07 14:38:38,386 INFO sqlalchemy.engine.Engine [cached since 0.4789s ago] {'id_1': UUID('38bf84f9-d0e9-4f37-b08a-8d86ada4b89f'), 'param_1': 1}
INFO:     127.0.0.1:59344 - "GET /api/forests/calculations/38bf84f9-d0e9-4f37-b08a-8d86ada4b89f HTTP/1.1" 200 OK
2026-02-07 14:38:38,408 INFO sqlalchemy.engine.Engine ROLLBACK
